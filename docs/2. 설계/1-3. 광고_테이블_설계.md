# ê´‘ê³  ì—”ì§„ í…Œì´ë¸” ì„¤ê³„

## ğŸ“‹ ëª©ì°¨
1. [ë°ì´í„°ë² ì´ìŠ¤ ì•„í‚¤í…ì²˜ ê°œìš”](#-ë°ì´í„°ë² ì´ìŠ¤-ì•„í‚¤í…ì²˜-ê°œìš”)
2. [í…Œì´ë¸” ë¶„ë¥˜ ë° êµ¬ì„±](#-í…Œì´ë¸”-ë¶„ë¥˜-ë°-êµ¬ì„±)
3. [ë§ˆìŠ¤í„° ë°ì´í„° í…Œì´ë¸”](#-ë§ˆìŠ¤í„°-ë°ì´í„°-í…Œì´ë¸”)
4. [ì”ì•¡ ê´€ë¦¬ í…Œì´ë¸”](#-ì”ì•¡-ê´€ë¦¬-í…Œì´ë¸”)
5. [ìš´ì˜ ê´€ë¦¬ í…Œì´ë¸”](#-ìš´ì˜-ê´€ë¦¬-í…Œì´ë¸”)
6. [ì„±ê³¼ ë¶„ì„ í…Œì´ë¸”](#-ì„±ê³¼-ë¶„ì„-í…Œì´ë¸”)
7. [ì‹œìŠ¤í…œ ì„¤ì • í…Œì´ë¸”](#-ì‹œìŠ¤í…œ-ì„¤ì •-í…Œì´ë¸”)
8. [íŒŒí‹°ì…”ë‹ ë° ì„±ëŠ¥ ìµœì í™”](#-íŒŒí‹°ì…”ë‹-ë°-ì„±ëŠ¥-ìµœì í™”)

---

## ğŸ—ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì•„í‚¤í…ì²˜ ê°œìš”

### ERD (Entity Relationship Diagram)

```mermaid
erDiagram
    %% ë§ˆìŠ¤í„° ë°ì´í„°
    ad_advertisers ||--o{ ad_campaigns : "ê´‘ê³ ì£¼ê°€ ì—¬ëŸ¬ ìº í˜ì¸ ì†Œìœ "
    ad_campaigns ||--o{ ad_placement_bids : "ìº í˜ì¸ì´ ì—¬ëŸ¬ ì…ì°° ì„¤ì • ë³´ìœ "
    ad_campaigns ||--o{ ad_daily_budget_trackings : "ìº í˜ì¸ë³„ ì¼ì¼ ì˜ˆì‚° ì¶”ì "
    ad_campaigns ||--o{ ad_performance_metrics_realtime : "ìº í˜ì¸ë³„ ì‹¤ì‹œê°„ ì„±ê³¼"
    ad_campaigns ||--o{ ad_event_summaries_daily : "ìº í˜ì¸ë³„ ì¼ì¼ ìš”ì•½"
    
    %% ìƒí’ˆ ê´€ë ¨
    ad_products_meta ||--o{ ad_placement_bids : "ìƒí’ˆë³„ ì…ì°° ì„¤ì •"
    ad_products_meta ||--o{ ad_product_status_caches : "ìƒí’ˆë³„ ì„±ê³¼ ìºì‹œ"
    ad_products_meta ||--o{ ad_impression_pricings : "ìƒí’ˆë³„ ë…¸ì¶œ ê°€ê²©"
    ad_products_meta ||--o{ ad_performance_metrics_realtime : "ìƒí’ˆë³„ ì‹¤ì‹œê°„ ì„±ê³¼"
    ad_products_meta ||--o{ ad_event_summaries_daily : "ìƒí’ˆë³„ ì¼ì¼ ìš”ì•½"
    
    %% ì”ì•¡ ê´€ë¦¬
    ad_advertisers ||--|| ad_balances : "ê´‘ê³ ì£¼ë³„ ì”ì•¡ ì •ë³´"
    ad_advertisers ||--o{ ad_balance_histories : "ê´‘ê³ ì£¼ë³„ ì”ì•¡ ì´ë ¥"
    
    %% ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
    ad_category_hierarchies ||--o{ ad_category_hierarchies : "ìƒìœ„-í•˜ìœ„ ì¹´í…Œê³ ë¦¬"
    
    %% ì‹œìŠ¤í…œ ì„¤ì •
    ad_engine_parameters ||--o{ ad_engine_parameter_histories : "íŒŒë¼ë¯¸í„° ë³€ê²½ ì´ë ¥"
    
    %% í…Œì´ë¸” ì •ì˜
    ad_advertisers {
        bigint id PK "ê´‘ê³ ì£¼ ID"
        varchar advertiser_name "ê´‘ê³ ì£¼ëª…"
        varchar business_type "ì‚¬ì—… ìœ í˜•"
        varchar status "ìƒíƒœ"
        decimal credit_limit "ì‹ ìš© í•œë„"
        decimal daily_budget "ì¼ì¼ ì˜ˆì‚°"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
        timestamp updated_at "ìˆ˜ì •ì¼ì‹œ"
    }
    
    ad_campaigns {
        bigint id PK "ìº í˜ì¸ ID"
        bigint advertiser_id FK "ê´‘ê³ ì£¼ ID"
        varchar campaign_name "ìº í˜ì¸ëª…"
        varchar campaign_type "ê³¼ê¸ˆ ë°©ì‹"
        varchar status "ìº í˜ì¸ ìƒíƒœ"
        date start_date "ì‹œì‘ì¼"
        date end_date "ì¢…ë£Œì¼"
        decimal daily_budget "ì¼ì¼ ì˜ˆì‚°"
        decimal total_budget "ì´ ì˜ˆì‚°"
        json target_regions "íƒ€ê²Ÿ ì§€ì—­"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
        timestamp updated_at "ìˆ˜ì •ì¼ì‹œ"
    }
    
    ad_products_meta {
        bigint product_id PK "ìƒí’ˆ ID"
        decimal quality_score "í’ˆì§ˆ ì ìˆ˜"
        varchar ad_status "ê´‘ê³  ìƒíƒœ"
        varchar category_path "ì¹´í…Œê³ ë¦¬ ê²½ë¡œ"
        timestamp updated_at "ìµœì¢… ìˆ˜ì •ì¼ì‹œ"
    }
    
    ad_placement_bids {
        bigint id PK "ì…ì°° ID"
        bigint campaign_id FK "ìº í˜ì¸ ID"
        bigint product_id FK "ìƒí’ˆ ID"
        varchar placement "ê´‘ê³  ì˜ì—­"
        decimal bid_price "ì…ì°°ê°€"
        decimal max_daily_spend "ì¼ì¼ ìµœëŒ€ ì†Œì§„"
        varchar status "ì…ì°° ìƒíƒœ"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
        timestamp updated_at "ìˆ˜ì •ì¼ì‹œ"
    }
    
    ad_balances {
        bigint advertiser_id PK,FK "ê´‘ê³ ì£¼ ID"
        decimal current_balance "í˜„ì¬ ì”ì•¡"
        decimal reserved_balance "ì˜ˆì•½ ì”ì•¡"
        decimal daily_spent "ì¼ì¼ ì‚¬ìš©"
        decimal monthly_spent "ì›” ì‚¬ìš©"
        date last_spent_date "ìµœì¢… ì‚¬ìš©ì¼"
        decimal alert_threshold "ì•Œë¦¼ ì„ê³„ê°’"
        boolean auto_charge_enabled "ìë™ ì¶©ì „"
        decimal auto_charge_amount "ìë™ ì¶©ì „ ê¸ˆì•¡"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
        timestamp updated_at "ìˆ˜ì •ì¼ì‹œ"
    }
    
    ad_balance_histories {
        bigint id PK "ì´ë ¥ ID"
        bigint advertiser_id FK "ê´‘ê³ ì£¼ ID"
        varchar transaction_type "ê±°ë˜ ìœ í˜•"
        decimal amount "ê±°ë˜ ê¸ˆì•¡"
        decimal balance_before "ê±°ë˜ ì „ ì”ì•¡"
        decimal balance_after "ê±°ë˜ í›„ ì”ì•¡"
        varchar reference_id "ì°¸ì¡° ID"
        varchar reference_type "ì°¸ì¡° ìœ í˜•"
        text description "ê±°ë˜ ì„¤ëª…"
        timestamp created_at "ê±°ë˜ ì¼ì‹œ"
    }
    
    ad_daily_budget_trackings {
        bigint id PK "ì¶”ì  ID"
        bigint campaign_id FK "ìº í˜ì¸ ID"
        date track_date "ì¶”ì  ì¼ì"
        decimal daily_budget "ì¼ì¼ ì˜ˆì‚°"
        decimal spent_amount "ì‚¬ìš© ê¸ˆì•¡"
        bigint impression_count "ë…¸ì¶œ ìˆ˜"
        bigint click_count "í´ë¦­ ìˆ˜"
        bigint conversion_count "ì „í™˜ ìˆ˜"
        timestamp updated_at "ìµœì¢… ì—…ë°ì´íŠ¸"
    }
    
    ad_product_status_caches {
        bigint product_id PK,FK "ìƒí’ˆ ID"
        decimal ctr_score "CTR ì ìˆ˜"
        decimal cvr_score "CVR ì ìˆ˜"
        decimal popularity_score "ì¸ê¸°ë„ ì ìˆ˜"
        timestamp last_impression "ìµœì¢… ë…¸ì¶œ"
        timestamp last_click "ìµœì¢… í´ë¦­"
        timestamp last_conversion "ìµœì¢… ì „í™˜"
        bigint impression_count_1h "1ì‹œê°„ ë…¸ì¶œ"
        bigint click_count_1h "1ì‹œê°„ í´ë¦­"
        bigint impression_count_24h "24ì‹œê°„ ë…¸ì¶œ"
        bigint click_count_24h "24ì‹œê°„ í´ë¦­"
        bigint conversion_count_24h "24ì‹œê°„ ì „í™˜"
        timestamp updated_at "ìºì‹œ ì—…ë°ì´íŠ¸"
    }
    
    ad_impression_pricings {
        varchar impression_id PK "ë…¸ì¶œ ê³ ìœ  ì‹ë³„ì"
        varchar device_id "ë””ë°”ì´ìŠ¤ ì‹ë³„ì"
        varchar session_id "ì„¸ì…˜ ì‹ë³„ì"
        bigint campaign_id FK "ìº í˜ì¸ ID"
        bigint product_id FK "ìƒí’ˆ ID"
        varchar placement "ê´‘ê³  ì˜ì—­"
        decimal bid_price "ì…ì°°ê°€"
        decimal calculated_price "ì‚°ì •ëœ ì ìš©ê°€"
        int ad_rank "ê´‘ê³  ìˆœìœ„"
        decimal algorithm_score "ì•Œê³ ë¦¬ì¦˜ ì ìˆ˜"
        varchar experiment_key "ì‹¤í—˜ í‚¤"
        varchar experiment_var "ì‹¤í—˜ ë³€ìˆ˜"
        timestamp impression_time "ë…¸ì¶œ ì‹œê°„"
        timestamp expires_at "ë§Œë£Œ ì‹œê°„"
        timestamp created_at "ìƒì„± ì‹œê°„"
    }
    
    ad_performance_metrics_realtime {
        bigint id PK "ë©”íŠ¸ë¦­ ID"
        bigint campaign_id FK "ìº í˜ì¸ ID"
        bigint product_id FK "ìƒí’ˆ ID"
        varchar placement "ê´‘ê³  ì˜ì—­"
        timestamp metric_hour "ë©”íŠ¸ë¦­ ì‹œê°„"
        bigint impression_count "ë…¸ì¶œ ìˆ˜"
        bigint click_count "í´ë¦­ ìˆ˜"
        bigint conversion_count "ì „í™˜ ìˆ˜"
        decimal total_spend "ì´ ì†Œì§„"
        decimal total_revenue "ì´ ë§¤ì¶œ"
        decimal avg_cpc "í‰ê·  CPC"
        decimal ctr "í´ë¦­ë¥ "
        decimal cvr "ì „í™˜ìœ¨"
        decimal roas "ê´‘ê³  ìˆ˜ìµë¥ "
        timestamp updated_at "ì—…ë°ì´íŠ¸ ì‹œê°„"
    }
    
    ad_event_summaries_daily {
        bigint id PK "ìš”ì•½ ID"
        date summary_date "ìš”ì•½ ë‚ ì§œ"
        bigint campaign_id FK "ìº í˜ì¸ ID"
        bigint product_id FK "ìƒí’ˆ ID"
        varchar placement "ê´‘ê³  ì˜ì—­"
        bigint impression_count "ë…¸ì¶œ ìˆ˜"
        bigint click_count "í´ë¦­ ìˆ˜"
        bigint conversion_count "ì „í™˜ ìˆ˜"
        decimal total_spend "ì´ ì†Œì§„"
        decimal total_revenue "ì´ ë§¤ì¶œ"
        bigint unique_users "ìˆœ ì‚¬ìš©ì"
        varchar s3_path "S3 ê²½ë¡œ"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
    }
    
    ad_category_defense_stats {
        bigint id PK "í†µê³„ ID"
        varchar category_path "ì¹´í…Œê³ ë¦¬ ê²½ë¡œ"
        tinyint category_level "ì¹´í…Œê³ ë¦¬ ë ˆë²¨"
        decimal avg_ctr "í‰ê·  CTR"
        decimal min_ctr "ìµœì†Œ CTR"
        decimal avg_cvr "í‰ê·  CVR"
        decimal min_cvr "ìµœì†Œ CVR"
        bigint sample_count "ìƒ˜í”Œ ìˆ˜"
        varchar calculation_period "ê³„ì‚° ê¸°ê°„"
        timestamp last_calculated "ë§ˆì§€ë§‰ ê³„ì‚°"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
        timestamp updated_at "ìˆ˜ì •ì¼ì‹œ"
    }
    
    ad_category_hierarchies {
        bigint id PK "ì¹´í…Œê³ ë¦¬ ID"
        varchar category_name "ì¹´í…Œê³ ë¦¬ëª…"
        tinyint category_level "ì¹´í…Œê³ ë¦¬ ë ˆë²¨"
        bigint parent_id FK "ìƒìœ„ ì¹´í…Œê³ ë¦¬"
        varchar category_path "ì¹´í…Œê³ ë¦¬ ê²½ë¡œ"
        int display_order "í‘œì‹œ ìˆœì„œ"
        boolean is_active "í™œì„±í™” ìƒíƒœ"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
        timestamp updated_at "ìˆ˜ì •ì¼ì‹œ"
    }
    
    ad_engine_parameters {
        bigint id PK "íŒŒë¼ë¯¸í„° ID"
        varchar parameter_name "íŒŒë¼ë¯¸í„°ëª…"
        decimal parameter_value "íŒŒë¼ë¯¸í„° ê°’"
        text description "ì„¤ëª…"
        varchar placement "ì ìš© ì˜ì—­"
        boolean is_active "í™œì„±í™” ìƒíƒœ"
        timestamp effective_from "ì ìš© ì‹œì‘"
        timestamp effective_until "ì ìš© ì¢…ë£Œ"
        varchar created_by "ìƒì„±ì"
        timestamp created_at "ìƒì„±ì¼ì‹œ"
    }
    
    ad_engine_parameter_histories {
        bigint id PK "ì´ë ¥ ID"
        bigint parameter_id FK "íŒŒë¼ë¯¸í„° ID"
        decimal old_value "ë³€ê²½ ì „ ê°’"
        decimal new_value "ë³€ê²½ í›„ ê°’"
        text change_reason "ë³€ê²½ ì‚¬ìœ "
        varchar changed_by "ë³€ê²½ì"
        timestamp effective_from "ì ìš© ì‹œì‘"
        timestamp created_at "ê¸°ë¡ ì‹œê°„"
    }
```

---

## ğŸ“Š í…Œì´ë¸” ë¶„ë¥˜ ë° êµ¬ì„±

> **ğŸ¯ ì„¤ê³„ ì² í•™**: ë°ì´í„° ë¬´ê²°ì„±, ì„±ëŠ¥ ìµœì í™”, í™•ì¥ì„±, ìœ ì§€ë³´ìˆ˜ì„±
> 
> **í•µì‹¬ ê°œì„ **: ì‹¤ì‹œê°„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ DB, ë¶„ì„ìš© ì›ì‹œ ë°ì´í„°ëŠ” S3

| ë¶„ë¥˜ | í…Œì´ë¸” ìˆ˜ | í…Œì´ë¸”ëª… | ì£¼ìš” ëª©ì  |
|------|-----------|----------|-----------|
| **ë§ˆìŠ¤í„° ë°ì´í„°** | 4ê°œ | `ad_advertisers`, `ad_campaigns`, `ad_products_meta`, `ad_placement_bids` | ê´‘ê³ ì£¼, ìº í˜ì¸, ìƒí’ˆ, ì…ì°° ê¸°ë³¸ ì •ë³´ |
| **ì”ì•¡ ê´€ë¦¬** | 2ê°œ | `ad_balances`, `ad_balance_histories` | ì‹¤ì‹œê°„ ì”ì•¡ ì¶”ì  ë° ì´ë ¥ ê´€ë¦¬ |
| **ìš´ì˜ ê´€ë¦¬** | 3ê°œ | `ad_daily_budget_trackings`, `ad_product_status_caches`, `ad_impression_pricings` | ì˜ˆì‚° ì¶”ì , ì„±ê³¼ ìºì‹œ, ë…¸ì¶œ ê°€ê²© ë§¤í•‘ |
| **ì„±ê³¼ ë¶„ì„** | 2ê°œ | `ad_performance_metrics_realtime`, `ad_event_summaries_daily` | ì‹¤ì‹œê°„ ì„±ê³¼ ì§€í‘œ ë° ì¼ë³„ ìš”ì•½ |
| **ì‹œìŠ¤í…œ ì„¤ì •** | 4ê°œ | `ad_category_defense_stats`, `ad_category_hierarchies`, `ad_engine_parameters`, `ad_engine_parameter_histories` | ë°©ì–´ê°’ í†µê³„, ì¹´í…Œê³ ë¦¬ ê³„ì¸µ, ì—”ì§„ íŒŒë¼ë¯¸í„° |

**ì´ 15ê°œ í…Œì´ë¸”**ë¡œ êµ¬ì„±ëœ íš¨ìœ¨ì ì¸ ë°ì´í„° ì•„í‚¤í…ì²˜

---

## ğŸ¯ ë§ˆìŠ¤í„° ë°ì´í„° í…Œì´ë¸”

### 1. ê´‘ê³ ì£¼ ê´€ë¦¬ (ad_advertisers) -> **ê±°ë˜ì²˜ í…Œì´ë¸”ì—ì„œ ì¨ì•¼ ë¨**
> **ëª©ì **: ê´‘ê³ ì£¼ ì •ë³´ ë° ìƒíƒœ ê´€ë¦¬
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ê´‘ê³ ì£¼ ìŠ¹ì¸/ì¤‘ë‹¨, ì—°ë½ì²˜ ê´€ë¦¬, ê³¼ê¸ˆ íƒ€ì… ì„¤ì •

```sql
CREATE TABLE ad_advertisers (
    id              BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ê´‘ê³ ì£¼ ê³ ìœ  ì‹ë³„ì',
    advertiser_name VARCHAR(255)                                   NOT NULL                    COMMENT 'ê´‘ê³ ì£¼ íšŒì‚¬ëª…/ë¸Œëœë“œëª…',
    business_type   VARCHAR(20)                                    NOT NULL                    COMMENT 'ì‚¬ì—… ìœ í˜• (BRAND/COMMERCE/SERVICE)',
    status          VARCHAR(20)                                    DEFAULT 'ACTIVE'            COMMENT 'ê´‘ê³ ì£¼ ìƒíƒœ (ACTIVE/INACTIVE/SUSPENDED)',
    credit_limit    DECIMAL(15,2)                                  DEFAULT 0.00                COMMENT 'ì‹ ìš© í•œë„ (ì›)',
    daily_budget    DECIMAL(15,2)                                  DEFAULT 0.00                COMMENT 'ì¼ì¼ ì˜ˆì‚° í•œë„ (ì›)',
    created_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ê³„ì • ìƒì„±ì¼ì‹œ',
    updated_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    INDEX idx_status_type (status, business_type),
    INDEX idx_updated_at (updated_at)
) ENGINE=InnoDB COMMENT='ê´‘ê³ ì£¼ ë§ˆìŠ¤í„° ì •ë³´ - ê´‘ê³  ê³„ì • ê¸°ë³¸ ì •ë³´ ê´€ë¦¬';
```

### 2. ìº í˜ì¸ ê´€ë¦¬ (ad_campaigns)
> **ëª©ì **: ê´‘ê³  ìº í˜ì¸ ì„¤ì • ë° ìƒíƒœ ê´€ë¦¬
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ìº í˜ì¸ ê¸°ê°„, ì˜ˆì‚°, íƒ€ê²ŸíŒ… ì„¤ì •

```sql
CREATE TABLE ad_campaigns (
    id               BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ìº í˜ì¸ ê³ ìœ  ì‹ë³„ì',
    advertiser_id    BIGINT                                         NOT NULL                    COMMENT 'ê´‘ê³ ì£¼ ì‹ë³„ì (FK)',
    campaign_name    VARCHAR(100)                                   NOT NULL                    COMMENT 'ìº í˜ì¸ëª…',
    campaign_type    VARCHAR(20)                                    DEFAULT 'CPC'               COMMENT 'ê³¼ê¸ˆ ë°©ì‹ (CPC/CPM/CPA)',
    status           VARCHAR(20)                                    DEFAULT 'PENDING'           COMMENT 'ìº í˜ì¸ ìƒíƒœ (ACTIVE/PAUSED/ENDED/PENDING)',
    start_date       DATE                                           NOT NULL                    COMMENT 'ìº í˜ì¸ ì‹œì‘ì¼',
    end_date         DATE                                                                       COMMENT 'ìº í˜ì¸ ì¢…ë£Œì¼ (NULL=ë¬´ì œí•œ)',
    daily_budget     DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ì¼ì¼ ì˜ˆì‚° (ì›)',
    total_budget     DECIMAL(15,2)                                                              COMMENT 'ì´ ì˜ˆì‚° (ì›, NULL=ë¬´ì œí•œ)',
    target_gender    VARCHAR(20)                                    DEFAULT 'ALL'               COMMENT 'íƒ€ê²Ÿ ì„±ë³„ (ALL/MALE/FEMALE)',
    target_age_min   INT                                            DEFAULT 0                   COMMENT 'íƒ€ê²Ÿ ìµœì†Œ ì—°ë ¹',
    target_age_max   INT                                            DEFAULT 100                 COMMENT 'íƒ€ê²Ÿ ìµœëŒ€ ì—°ë ¹',
    target_regions   JSON                                                                       COMMENT 'íƒ€ê²Ÿ ì§€ì—­ ëª©ë¡ (JSON ë°°ì—´)',
    created_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ìº í˜ì¸ ìƒì„±ì¼ì‹œ',
    updated_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    FOREIGN KEY (advertiser_id) REFERENCES ad_advertisers(id),
    INDEX idx_advertiser_status (advertiser_id, status),
    INDEX idx_status_dates (status, start_date, end_date),
    INDEX idx_updated_at (updated_at)
) ENGINE=InnoDB COMMENT='ê´‘ê³  ìº í˜ì¸ ì •ë³´';
```

### 3. ìƒí’ˆ ë©”íƒ€ë°ì´í„° (ad_products_meta)
> **ëª©ì **: ê´‘ê³  ìƒí’ˆì˜ ë©”íƒ€ ì •ë³´ ë° ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ìƒí’ˆ ë¶„ë¥˜, ê²€ìƒ‰ ìµœì í™”, ì„±ê³¼ ë¶„ì„

```sql
CREATE TABLE ad_products_meta (
    product_id      BIGINT                                         PRIMARY KEY                 COMMENT 'ìƒí’ˆ ì‹ë³„ì (ê¸°ì¡´ ìƒí’ˆ í…Œì´ë¸” ì°¸ì¡°)',
    quality_score   DECIMAL(3,2)                                   DEFAULT 1.00                COMMENT 'ê´‘ê³  í’ˆì§ˆ ì ìˆ˜ (0.00~5.00)',
    ad_status       VARCHAR(20)                                    DEFAULT 'ACTIVE'            COMMENT 'ê´‘ê³  ê°€ëŠ¥ ìƒíƒœ (ACTIVE/PAUSED/BLOCKED)',
    category_path   VARCHAR(200)                                                               COMMENT 'ì¹´í…Œê³ ë¦¬ ê²½ë¡œ ìºì‹œ (ì„±ëŠ¥ ìµœì í™”ìš©)',
    updated_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    INDEX idx_quality_score (quality_score DESC),
    INDEX idx_ad_status (ad_status),
    INDEX idx_category_path (category_path),
    CHECK (quality_score >= 0.00 AND quality_score <= 5.00)
) ENGINE=InnoDB COMMENT='ê´‘ê³  ìƒí’ˆ ë©”íƒ€ì •ë³´';
```

### 4. ë°°ì¹˜ ì…ì°°ê°€ (ad_placement_bids)
> **ëª©ì **: ê´‘ê³  ì˜ì—­ë³„ ì…ì°°ê°€ ì„¤ì • ê´€ë¦¬
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ì˜ì—­ë³„ ì°¨ë“± ì…ì°°, ì‹œê°„ëŒ€ë³„ ì¡°ì •

```sql
CREATE TABLE ad_placement_bids (
    id              BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ì…ì°° ì„¤ì • ê³ ìœ  ì‹ë³„ì',
    campaign_id     BIGINT                                         NOT NULL                    COMMENT 'ìº í˜ì¸ ì‹ë³„ì (FK)',
    product_id      BIGINT                                         NOT NULL                    COMMENT 'ìƒí’ˆ ì‹ë³„ì (ê¸°ì¡´ ìƒí’ˆ í…Œì´ë¸” ì°¸ì¡°)',
    placement       VARCHAR(20)                                    NOT NULL                    COMMENT 'ê´‘ê³  ì˜ì—­ (HOME/CATEGORY/PRODUCT_DETAIL/SEARCH)',
    bid_price       DECIMAL(10,2)                                  NOT NULL                    COMMENT 'ì…ì°°ê°€ (ì›) - ê´‘ê³  ì•Œê³ ë¦¬ì¦˜ì˜ B(a,i)',
    max_daily_spend DECIMAL(15,2)                                                              COMMENT 'ì¼ì¼ ìµœëŒ€ ì†Œì§„ ê¸ˆì•¡ (ì›)',
    status          VARCHAR(20)                                    DEFAULT 'ACTIVE'            COMMENT 'ì…ì°° ìƒíƒœ (ACTIVE/PAUSED)',
    created_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ì…ì°° ì„¤ì • ìƒì„±ì¼ì‹œ',
    updated_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    FOREIGN KEY (campaign_id) REFERENCES ad_campaigns(id),
    UNIQUE KEY uk_campaign_product_placement (campaign_id, product_id, placement),
    INDEX idx_placement_status (placement, status),
    INDEX idx_bid_price (bid_price DESC),
    INDEX idx_updated_at (updated_at)
) ENGINE=InnoDB COMMENT='ì˜ì—­ë³„ ìƒí’ˆ ì…ì°°ê°€ ì„¤ì •';
```

### 5. ì”ì•¡ ê´€ë¦¬ (ad_balances)
> **ëª©ì **: ì‹¤ì‹œê°„ ì”ì•¡ ì²´í¬ ë° ì°¨ê°
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ì”ì•¡ ë¶€ì¡± ì‹œ ê´‘ê³  ì¤‘ë‹¨, ì‹¤ì‹œê°„ ì°¨ê° ì²˜ë¦¬

```sql
CREATE TABLE ad_balances (
    advertiser_id     BIGINT                                        PRIMARY KEY                 COMMENT 'ê´‘ê³ ì£¼ ì‹ë³„ì (FK)',
    current_balance   DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ (ì›)',
    reserved_balance  DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'ì§„í–‰ì¤‘ ê´‘ê³  ì˜ˆì•½ ê¸ˆì•¡ (ì›)',
    daily_spent       DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'ê¸ˆì¼ ì‚¬ìš© ê¸ˆì•¡ (ì›)',
    monthly_spent     DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'ë‹¹ì›” ì‚¬ìš© ê¸ˆì•¡ (ì›)',
    last_spent_date   DATE                                                                       COMMENT 'ìµœì¢… ì‚¬ìš©ì¼',
    alert_threshold   DECIMAL(15,2)                                 DEFAULT 10000.00             COMMENT 'ì”ì•¡ ë¶€ì¡± ì•Œë¦¼ ì„ê³„ê°’ (ì›)',
    auto_charge_enabled BOOLEAN                                     DEFAULT FALSE                COMMENT 'ìë™ ì¶©ì „ í™œì„±í™” ì—¬ë¶€',
    auto_charge_amount DECIMAL(15,2)                                DEFAULT 0.00                 COMMENT 'ìë™ ì¶©ì „ ê¸ˆì•¡ (ì›)',
    created_at        TIMESTAMP                                     DEFAULT CURRENT_TIMESTAMP   COMMENT 'ê³„ì • ìƒì„±ì¼ì‹œ',
    updated_at        TIMESTAMP                                     DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    FOREIGN KEY (advertiser_id) REFERENCES ad_advertisers(id),
    INDEX idx_balance_threshold (current_balance, alert_threshold),
    INDEX idx_last_spent_date (last_spent_date),
    CHECK (current_balance >= 0),
    CHECK (reserved_balance >= 0)
) ENGINE=InnoDB COMMENT='ê´‘ê³ ì£¼ ì”ì•¡ ê´€ë¦¬';
```

### 6. ì”ì•¡ ì´ë ¥ (ad_balance_histories)
> **ëª©ì **: ì”ì•¡ ë³€ë™ ì´ë ¥ ì¶”ì  ë° ê°ì‚¬
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ì¶©ì „/ì°¨ê° ë‚´ì—­ ì¶”ì , íšŒê³„ ê°ì‚¬

```sql
CREATE TABLE ad_balance_histories (
    id               BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ì”ì•¡ ë³€ê²½ ì´ë ¥ ê³ ìœ  ì‹ë³„ì',
    advertiser_id    BIGINT                                         NOT NULL                    COMMENT 'ê´‘ê³ ì£¼ ì‹ë³„ì (FK)',
    transaction_type VARCHAR(20)                                    NOT NULL                    COMMENT 'ê±°ë˜ ìœ í˜• (CHARGE/SPEND/REFUND/ADJUSTMENT)',
    amount           DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ê±°ë˜ ê¸ˆì•¡ (ì›)',
    balance_before   DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ê±°ë˜ ì „ ì”ì•¡ (ì›)',
    balance_after    DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ê±°ë˜ í›„ ì”ì•¡ (ì›)',
    reference_id     VARCHAR(50)                                                                COMMENT 'ì°¸ì¡° ID (ì£¼ë¬¸ID, ìº í˜ì¸ID ë“±)',
    reference_type   VARCHAR(20)                                                                COMMENT 'ì°¸ì¡° ìœ í˜• (CAMPAIGN/ORDER/MANUAL/AUTO_CHARGE)',
    description      TEXT                                                                       COMMENT 'ê±°ë˜ ìƒì„¸ ì„¤ëª…',
    created_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ê±°ë˜ ë°œìƒì¼ì‹œ',
    
    FOREIGN KEY (advertiser_id) REFERENCES ad_advertisers(id),
    INDEX idx_advertiser_created (advertiser_id, created_at),
    INDEX idx_transaction_type (transaction_type),
    INDEX idx_reference (reference_type, reference_id)
) ENGINE=InnoDB COMMENT='ê´‘ê³ ì£¼ ì”ì•¡ ë³€ê²½ ì´ë ¥';
```

---

## ğŸ’° ì”ì•¡ ê´€ë¦¬ í…Œì´ë¸”

### 5. ì”ì•¡ ê´€ë¦¬ (ad_balances)
> **ëª©ì **: ì‹¤ì‹œê°„ ì”ì•¡ ì²´í¬ ë° ì°¨ê°
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ì”ì•¡ ë¶€ì¡± ì‹œ ê´‘ê³  ì¤‘ë‹¨, ì‹¤ì‹œê°„ ì°¨ê° ì²˜ë¦¬

```sql
CREATE TABLE ad_balances (
    advertiser_id     BIGINT                                        PRIMARY KEY                 COMMENT 'ê´‘ê³ ì£¼ ì‹ë³„ì (FK)',
    current_balance   DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ (ì›)',
    reserved_balance  DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'ì§„í–‰ì¤‘ ê´‘ê³  ì˜ˆì•½ ê¸ˆì•¡ (ì›)',
    daily_spent       DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'ê¸ˆì¼ ì‚¬ìš© ê¸ˆì•¡ (ì›)',
    monthly_spent     DECIMAL(15,2)                                 NOT NULL DEFAULT 0.00       COMMENT 'ë‹¹ì›” ì‚¬ìš© ê¸ˆì•¡ (ì›)',
    last_spent_date   DATE                                                                       COMMENT 'ìµœì¢… ì‚¬ìš©ì¼',
    alert_threshold   DECIMAL(15,2)                                 DEFAULT 10000.00             COMMENT 'ì”ì•¡ ë¶€ì¡± ì•Œë¦¼ ì„ê³„ê°’ (ì›)',
    auto_charge_enabled BOOLEAN                                     DEFAULT FALSE                COMMENT 'ìë™ ì¶©ì „ í™œì„±í™” ì—¬ë¶€',
    auto_charge_amount DECIMAL(15,2)                                DEFAULT 0.00                 COMMENT 'ìë™ ì¶©ì „ ê¸ˆì•¡ (ì›)',
    created_at        TIMESTAMP                                     DEFAULT CURRENT_TIMESTAMP   COMMENT 'ê³„ì • ìƒì„±ì¼ì‹œ',
    updated_at        TIMESTAMP                                     DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    FOREIGN KEY (advertiser_id) REFERENCES ad_advertisers(id),
    INDEX idx_balance_threshold (current_balance, alert_threshold),
    INDEX idx_last_spent_date (last_spent_date),
    CHECK (current_balance >= 0),
    CHECK (reserved_balance >= 0)
) ENGINE=InnoDB COMMENT='ê´‘ê³ ì£¼ ì”ì•¡ ê´€ë¦¬';
```

### 6. ì”ì•¡ ì´ë ¥ (ad_balance_histories)
> **ëª©ì **: ì”ì•¡ ë³€ë™ ì´ë ¥ ì¶”ì  ë° ê°ì‚¬
> **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ì¶©ì „/ì°¨ê° ë‚´ì—­ ì¶”ì , íšŒê³„ ê°ì‚¬

```sql
CREATE TABLE ad_balance_histories (
    id               BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ì”ì•¡ ë³€ê²½ ì´ë ¥ ê³ ìœ  ì‹ë³„ì',
    advertiser_id    BIGINT                                         NOT NULL                    COMMENT 'ê´‘ê³ ì£¼ ì‹ë³„ì (FK)',
    transaction_type VARCHAR(20)                                    NOT NULL                    COMMENT 'ê±°ë˜ ìœ í˜• (CHARGE/SPEND/REFUND/ADJUSTMENT)',
    amount           DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ê±°ë˜ ê¸ˆì•¡ (ì›)',
    balance_before   DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ê±°ë˜ ì „ ì”ì•¡ (ì›)',
    balance_after    DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ê±°ë˜ í›„ ì”ì•¡ (ì›)',
    reference_id     VARCHAR(50)                                                                COMMENT 'ì°¸ì¡° ID (ì£¼ë¬¸ID, ìº í˜ì¸ID ë“±)',
    reference_type   VARCHAR(20)                                                                COMMENT 'ì°¸ì¡° ìœ í˜• (CAMPAIGN/ORDER/MANUAL/AUTO_CHARGE)',
    description      TEXT                                                                       COMMENT 'ê±°ë˜ ìƒì„¸ ì„¤ëª…',
    created_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ê±°ë˜ ë°œìƒì¼ì‹œ',
    
    FOREIGN KEY (advertiser_id) REFERENCES ad_advertisers(id),
    INDEX idx_advertiser_created (advertiser_id, created_at),
    INDEX idx_transaction_type (transaction_type),
    INDEX idx_reference (reference_type, reference_id)
) ENGINE=InnoDB COMMENT='ê´‘ê³ ì£¼ ì”ì•¡ ë³€ê²½ ì´ë ¥';
```

---

## âš™ï¸ ìš´ì˜ ê´€ë¦¬ í…Œì´ë¸”

### 7. ì¼ì¼ ì˜ˆì‚° ì¶”ì  (ad_daily_budget_trackings)
```sql
CREATE TABLE ad_daily_budget_trackings (
    id              BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ì˜ˆì‚° ì¶”ì  ê³ ìœ  ì‹ë³„ì',
    campaign_id     BIGINT                                         NOT NULL                    COMMENT 'ìº í˜ì¸ ì‹ë³„ì (FK)',
    track_date      DATE                                           NOT NULL                    COMMENT 'ì¶”ì  ì¼ì',
    daily_budget    DECIMAL(15,2)                                  NOT NULL                    COMMENT 'ì„¤ì •ëœ ì¼ì¼ ì˜ˆì‚° (ì›)',
    spent_amount    DECIMAL(15,2)                                  NOT NULL DEFAULT 0.00       COMMENT 'ë‹¹ì¼ ì‚¬ìš© ê¸ˆì•¡ (ì›)',
    impression_count BIGINT                                        NOT NULL DEFAULT 0          COMMENT 'ë‹¹ì¼ ë…¸ì¶œ ìˆ˜',
    click_count     BIGINT                                         NOT NULL DEFAULT 0          COMMENT 'ë‹¹ì¼ í´ë¦­ ìˆ˜',
    conversion_count BIGINT                                        NOT NULL DEFAULT 0          COMMENT 'ë‹¹ì¼ ì „í™˜ ìˆ˜',
    updated_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ì—…ë°ì´íŠ¸ ì‹œê°„',
    
    FOREIGN KEY (campaign_id) REFERENCES ad_campaigns(id),
    UNIQUE KEY uk_campaign_date (campaign_id, track_date),
    INDEX idx_track_date (track_date),
    INDEX idx_spent_budget (spent_amount, daily_budget)
) ENGINE=InnoDB COMMENT='ìº í˜ì¸ë³„ ì¼ì¼ ì˜ˆì‚° ì‚¬ìš©ëŸ‰ ì¶”ì ';
```

### 8. ìƒí’ˆ ìƒíƒœ ìºì‹œ (ad_product_status_caches)
```sql
CREATE TABLE ad_product_status_caches (
    product_id       BIGINT                                         PRIMARY KEY                 COMMENT 'ìƒí’ˆ ì‹ë³„ì (FK)',
    ctr_score        DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'í´ë¦­ë¥  ì ìˆ˜ (0.0000~1.0000)',
    cvr_score        DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'ì „í™˜ìœ¨ ì ìˆ˜ (0.0000~1.0000)',
    popularity_score DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'ì¸ê¸°ë„ ì ìˆ˜ (0.0000~1.0000)',
    last_impression  TIMESTAMP                                                                  COMMENT 'ìµœì¢… ë…¸ì¶œ ì‹œê°„',
    last_click       TIMESTAMP                                                                  COMMENT 'ìµœì¢… í´ë¦­ ì‹œê°„',
    last_conversion  TIMESTAMP                                                                  COMMENT 'ìµœì¢… ì „í™˜ ì‹œê°„',
    impression_count_1h  BIGINT                                     DEFAULT 0                   COMMENT '1ì‹œê°„ ë…¸ì¶œ ìˆ˜ (Ï‰1 ì„ê³„ê°’ ì²´í¬ìš©)',
    click_count_1h   BIGINT                                         DEFAULT 0                   COMMENT '1ì‹œê°„ í´ë¦­ ìˆ˜ (Ï‰2 ì„ê³„ê°’ ì²´í¬ìš©)',
    impression_count_24h BIGINT                                     DEFAULT 0                   COMMENT '24ì‹œê°„ ë…¸ì¶œ ìˆ˜',
    click_count_24h  BIGINT                                         DEFAULT 0                   COMMENT '24ì‹œê°„ í´ë¦­ ìˆ˜',
    conversion_count_24h BIGINT                                     DEFAULT 0                   COMMENT '24ì‹œê°„ ì „í™˜ ìˆ˜',
    last_threshold_check TIMESTAMP                                                              COMMENT 'ë§ˆì§€ë§‰ ì„ê³„ê°’ ì²´í¬ ì‹œê°„',
    updated_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìºì‹œ ì—…ë°ì´íŠ¸ ì‹œê°„',
    
    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_ctr_score (ctr_score DESC),
    INDEX idx_cvr_score (cvr_score DESC),
    INDEX idx_popularity_score (popularity_score DESC),
    INDEX idx_threshold_check (last_threshold_check),
    INDEX idx_cache_updated (updated_at)
) ENGINE=InnoDB COMMENT='ìƒí’ˆ ì„±ê³¼ ì§€í‘œ ìºì‹œ';
```

### 9. ë…¸ì¶œë³„ ê°€ê²© ë§¤í•‘ (ad_impression_pricings)
```sql
CREATE TABLE ad_impression_pricings (
    impression_id    VARCHAR(50)                                    PRIMARY KEY                 COMMENT 'ë…¸ì¶œ ê³ ìœ  ì‹ë³„ì (UUID)',
    device_id        VARCHAR(100)                                   NOT NULL                    COMMENT 'ë””ë°”ì´ìŠ¤ ì‹ë³„ì',
    session_id       VARCHAR(100)                                   NOT NULL                    COMMENT 'ì„¸ì…˜ ì‹ë³„ì',
    campaign_id      BIGINT                                         NOT NULL                    COMMENT 'ìº í˜ì¸ ì‹ë³„ì (FK)',
    product_id       BIGINT                                         NOT NULL                    COMMENT 'ìƒí’ˆ ì‹ë³„ì (FK)',
    placement        VARCHAR(20)                                    NOT NULL                    COMMENT 'ê´‘ê³  ì˜ì—­',
    bid_price        DECIMAL(10,2)                                  NOT NULL                    COMMENT 'ì…ì°°ê°€ (ì›)',
    calculated_price DECIMAL(10,2)                                  NOT NULL                    COMMENT 'ì‚°ì •ëœ ì ìš©ê°€ (ì›) - í´ë¦­ ì‹œ ì°¨ê°ë  ê¸ˆì•¡',
    ad_rank          INT                                            NOT NULL                    COMMENT 'ê´‘ê³  ìˆœìœ„ (1ë“±, 2ë“±, 3ë“±...)',
    algorithm_score  DECIMAL(10,4)                                  NOT NULL                    COMMENT 'ì•Œê³ ë¦¬ì¦˜ ì ìˆ˜ S_Î±(a,i)',
    experiment_key   VARCHAR(50)                                                                COMMENT 'ì‹¤í—˜ í‚¤',
    experiment_var   VARCHAR(50)                                                                COMMENT 'ì‹¤í—˜ ë³€ìˆ˜',
    impression_time  TIMESTAMP(3)                                   NOT NULL                    COMMENT 'ë…¸ì¶œ ì‹œê°„ (ë°€ë¦¬ì´ˆ í¬í•¨)',
    expires_at       TIMESTAMP                                      NOT NULL                    COMMENT 'ë§Œë£Œ ì‹œê°„ (24ì‹œê°„ í›„)',
    created_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ìƒì„± ì‹œê°„',
    
    FOREIGN KEY (campaign_id) REFERENCES ad_campaigns(id),
    FOREIGN KEY (product_id) REFERENCES ad_products_meta(product_id),
    INDEX idx_device_session (device_id, session_id),
    INDEX idx_product_placement (product_id, placement),
    INDEX idx_expires_at (expires_at),
    INDEX idx_impression_time (impression_time)
) ENGINE=InnoDB COMMENT='ë…¸ì¶œë³„ ê°€ê²© ë§¤í•‘';
```

---

## ğŸ“Š ì„±ê³¼ ë¶„ì„ í…Œì´ë¸”

### 10. ì‹¤ì‹œê°„ ì„±ê³¼ ë©”íŠ¸ë¦­ (ad_performance_metrics_realtime)
```sql
CREATE TABLE ad_performance_metrics_realtime (
    id               BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ê³ ìœ  ì‹ë³„ì',
    campaign_id      BIGINT                                         NOT NULL                    COMMENT 'ìº í˜ì¸ ì‹ë³„ì (FK)',
    product_id       BIGINT                                         NOT NULL                    COMMENT 'ìƒí’ˆ ì‹ë³„ì (FK)',
    placement        VARCHAR(20)                                    NOT NULL                    COMMENT 'ê´‘ê³  ì˜ì—­',
    metric_hour      TIMESTAMP                                      NOT NULL                    COMMENT 'ì‹œê°„ë³„ ë©”íŠ¸ë¦­ (ì‹œê°„ ë‹¨ìœ„ë¡œ ì ˆì‚­)',
    impression_count BIGINT                                         DEFAULT 0                   COMMENT 'ë…¸ì¶œ ìˆ˜',
    click_count      BIGINT                                         DEFAULT 0                   COMMENT 'í´ë¦­ ìˆ˜',
    conversion_count BIGINT                                         DEFAULT 0                   COMMENT 'ì „í™˜ ìˆ˜',
    total_spend      DECIMAL(15,2)                                  DEFAULT 0.00                COMMENT 'ì´ ì†Œì§„ ê¸ˆì•¡ (ì›)',
    total_revenue    DECIMAL(15,2)                                  DEFAULT 0.00                COMMENT 'ì´ ê¸°ì—¬ ë§¤ì¶œ (ì›)',
    avg_cpc          DECIMAL(10,2)                                  DEFAULT 0.00                COMMENT 'í‰ê·  í´ë¦­ë‹¹ ë¹„ìš© (ì›)',
    ctr              DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'í´ë¦­ë¥  (Click Through Rate)',
    cvr              DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'ì „í™˜ìœ¨ (Conversion Rate)',
    roas             DECIMAL(8,2)                                   DEFAULT 0.00                COMMENT 'ê´‘ê³  ìˆ˜ìµë¥  (Return on Ad Spend)',
    updated_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ì—…ë°ì´íŠ¸ ì‹œê°„',
    
    FOREIGN KEY (campaign_id) REFERENCES ad_campaigns(id),
    FOREIGN KEY (product_id) REFERENCES ad_products_meta(product_id),
    UNIQUE KEY uk_campaign_product_placement_hour (campaign_id, product_id, placement, metric_hour),
    INDEX idx_metric_hour (metric_hour),
    INDEX idx_placement_hour (placement, metric_hour),
    INDEX idx_roas (roas DESC),
    INDEX idx_last_updated (updated_at)
) ENGINE=InnoDB COMMENT='ì‹¤ì‹œê°„ ì„±ê³¼ ë©”íŠ¸ë¦­';
```

### 11. ì´ë²¤íŠ¸ ìš”ì•½ (ad_event_summaries_daily)
```sql
CREATE TABLE ad_event_summaries_daily (
    id               BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ì¼ë³„ ìš”ì•½ ê³ ìœ  ì‹ë³„ì',
    summary_date     DATE                                           NOT NULL                    COMMENT 'ìš”ì•½ ë‚ ì§œ',
    campaign_id      BIGINT                                         NOT NULL                    COMMENT 'ìº í˜ì¸ ì‹ë³„ì (FK)',
    product_id       BIGINT                                         NOT NULL                    COMMENT 'ìƒí’ˆ ì‹ë³„ì (FK)',
    placement        VARCHAR(20)                                    NOT NULL                    COMMENT 'ê´‘ê³  ì˜ì—­',
    impression_count BIGINT                                         DEFAULT 0                   COMMENT 'ë…¸ì¶œ ìˆ˜',
    click_count      BIGINT                                         DEFAULT 0                   COMMENT 'í´ë¦­ ìˆ˜',
    conversion_count BIGINT                                         DEFAULT 0                   COMMENT 'ì „í™˜ ìˆ˜',
    total_spend      DECIMAL(15,2)                                  DEFAULT 0.00                COMMENT 'ì´ ì†Œì§„ ê¸ˆì•¡ (ì›)',
    total_revenue    DECIMAL(15,2)                                  DEFAULT 0.00                COMMENT 'ì´ ê¸°ì—¬ ë§¤ì¶œ (ì›)',
    unique_users     BIGINT                                         DEFAULT 0                   COMMENT 'ìˆœ ì‚¬ìš©ì ìˆ˜',
    s3_path          VARCHAR(500)                                                               COMMENT 'í•´ë‹¹ ë‚ ì§œ S3 ì›ì‹œ ë°ì´í„° ê²½ë¡œ',
    created_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ìš”ì•½ ìƒì„±ì¼ì‹œ',
    
    FOREIGN KEY (campaign_id) REFERENCES ad_campaigns(id),
    UNIQUE KEY uk_daily_summary (summary_date, campaign_id, product_id, placement),
    INDEX idx_summary_date (summary_date),
    INDEX idx_campaign_date (campaign_id, summary_date),
    INDEX idx_placement_date (placement, summary_date)
) ENGINE=InnoDB COMMENT='ì¼ë³„ ì´ë²¤íŠ¸ ìš”ì•½';
```

---

## ğŸ”§ ì‹œìŠ¤í…œ ì„¤ì • í…Œì´ë¸”

### 12. ì¹´í…Œê³ ë¦¬ë³„ ë°©ì–´ê°’ í†µê³„ (ad_category_defense_stats)
```sql
CREATE TABLE ad_category_defense_stats (
    id               BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'í†µê³„ ê³ ìœ  ì‹ë³„ì',
    category_path    VARCHAR(400)                                   UNIQUE NOT NULL             COMMENT 'ì¹´í…Œê³ ë¦¬ ê²½ë¡œ (1ì°¨>2ì°¨>3ì°¨>4ì°¨)',
    category_level   TINYINT                                        NOT NULL                    COMMENT 'ì¹´í…Œê³ ë¦¬ ë ˆë²¨ (1/2/3/4)',
    avg_ctr          DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'ì¹´í…Œê³ ë¦¬ í‰ê·  CTR (ë°©ì–´ê°’ ê³„ì‚°ìš©)',
    min_ctr          DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'ì¹´í…Œê³ ë¦¬ ìµœì†Œ CTR (ë°©ì–´ê°’ ê³„ì‚°ìš©)',
    avg_cvr          DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'ì¹´í…Œê³ ë¦¬ í‰ê·  CVR (ë°©ì–´ê°’ ê³„ì‚°ìš©)',
    min_cvr          DECIMAL(6,4)                                   DEFAULT 0.0000              COMMENT 'ì¹´í…Œê³ ë¦¬ ìµœì†Œ CVR (ë°©ì–´ê°’ ê³„ì‚°ìš©)',
    sample_count     BIGINT                                         DEFAULT 0                   COMMENT 'í†µê³„ ê³„ì‚°ìš© ìƒ˜í”Œ ë°ì´í„° ê°œìˆ˜',
    calculation_period VARCHAR(20)                                  DEFAULT '30DAYS'            COMMENT 'í†µê³„ ê³„ì‚° ê¸°ê°„ (7DAYS/30DAYS/90DAYS)',
    last_calculated  TIMESTAMP                                                                  COMMENT 'ë§ˆì§€ë§‰ í†µê³„ ê³„ì‚° ì‹œê°„',
    created_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'í†µê³„ ìƒì„±ì¼ì‹œ',
    updated_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    INDEX idx_category_level (category_level),
    INDEX idx_path_level (category_path, category_level),
    INDEX idx_last_calculated (last_calculated),
    CHECK (category_level BETWEEN 1 AND 4),
    CHECK (avg_ctr >= 0.0000 AND avg_ctr <= 1.0000),
    CHECK (min_ctr >= 0.0000 AND min_ctr <= 1.0000),
    CHECK (avg_cvr >= 0.0000 AND avg_cvr <= 1.0000),
    CHECK (min_cvr >= 0.0000 AND min_cvr <= 1.0000)
) ENGINE=InnoDB COMMENT='ì¹´í…Œê³ ë¦¬ë³„ ë°©ì–´ê°’ í†µê³„ - RTB ì•Œê³ ë¦¬ì¦˜ ë°ì´í„° ë¶€ì¡± ì‹œ ëŒ€ì²´ê°’ ì œê³µ';
```

### 13. ì¹´í…Œê³ ë¦¬ ê³„ì¸µ (ad_category_hierarchies)
```sql
CREATE TABLE ad_category_hierarchies (
    id              BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'ì¹´í…Œê³ ë¦¬ ê³ ìœ  ì‹ë³„ì',
    category_name   VARCHAR(100)                                   NOT NULL                    COMMENT 'ì¹´í…Œê³ ë¦¬ëª…',
    category_level  TINYINT                                        NOT NULL                    COMMENT 'ì¹´í…Œê³ ë¦¬ ë ˆë²¨ (1/2/3/4)',
    parent_id       BIGINT                                                                     COMMENT 'ìƒìœ„ ì¹´í…Œê³ ë¦¬ ID (1ì°¨ëŠ” NULL)',
    category_path   VARCHAR(400)                                                               COMMENT 'ì¹´í…Œê³ ë¦¬ ì „ì²´ ê²½ë¡œ (1ì°¨>2ì°¨>3ì°¨>4ì°¨)',
    display_order   INT                                            DEFAULT 0                   COMMENT 'í‘œì‹œ ìˆœì„œ',
    is_active       BOOLEAN                                        DEFAULT TRUE                COMMENT 'í™œì„±í™” ìƒíƒœ',
    created_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ì¹´í…Œê³ ë¦¬ ìƒì„±ì¼ì‹œ',
    updated_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ìµœì¢… ìˆ˜ì •ì¼ì‹œ',
    
    FOREIGN KEY (parent_id) REFERENCES ad_category_hierarchies(id),
    INDEX idx_level_parent (category_level, parent_id),
    INDEX idx_path (category_path),
    INDEX idx_active_order (is_active, display_order),
    CHECK (category_level BETWEEN 1 AND 4)
) ENGINE=InnoDB COMMENT='ìƒí’ˆ ì¹´í…Œê³ ë¦¬ ê³„ì¸µ êµ¬ì¡° - 4ë‹¨ê³„ ë¶„ë¥˜ ì²´ê³„';
```

### 14. ì—”ì§„ íŒŒë¼ë¯¸í„° (ad_engine_parameters)
```sql
CREATE TABLE ad_engine_parameters (
    id              BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'íŒŒë¼ë¯¸í„° ê³ ìœ  ì‹ë³„ì',
    parameter_name  VARCHAR(100)                                   UNIQUE NOT NULL             COMMENT 'íŒŒë¼ë¯¸í„°ëª… (alpha/pi/omega1/omega2/delta)',
    parameter_value DECIMAL(10,4)                                  NOT NULL                    COMMENT 'íŒŒë¼ë¯¸í„° ê°’',
    description     TEXT                                                                       COMMENT 'íŒŒë¼ë¯¸í„° ì„¤ëª…',
    placement       VARCHAR(20)                                                                COMMENT 'ì ìš© ì˜ì—­ (NULL=ì „ì²´ ì ìš©)',
    is_active       BOOLEAN                                        DEFAULT TRUE                COMMENT 'í™œì„±í™” ìƒíƒœ',
    effective_from  TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ì ìš© ì‹œì‘ ì‹œê°„',
    effective_until TIMESTAMP                                                                  COMMENT 'ì ìš© ì¢…ë£Œ ì‹œê°„ (NULL=ë¬´ì œí•œ)',
    created_by      VARCHAR(100)                                   NOT NULL                    COMMENT 'ìƒì„±ì',
    created_at      TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'íŒŒë¼ë¯¸í„° ìƒì„±ì¼ì‹œ',
    
    INDEX idx_name_active (parameter_name, is_active),
    INDEX idx_placement (placement),
    INDEX idx_effective_period (effective_from, effective_until)
) ENGINE=InnoDB COMMENT='ê´‘ê³  ì—”ì§„ íŒŒë¼ë¯¸í„° ê´€ë¦¬ - ì•Œê³ ë¦¬ì¦˜ ì„¤ì •ê°’ ì¤‘ì•™ ê´€ë¦¬';
```

### 15. ì—”ì§„ íŒŒë¼ë¯¸í„° ë³€ê²½ ì´ë ¥ (ad_engine_parameter_histories)
```sql
CREATE TABLE ad_engine_parameter_histories (
    id               BIGINT                                         PRIMARY KEY AUTO_INCREMENT COMMENT 'íŒŒë¼ë¯¸í„° ë³€ê²½ ì´ë ¥ ê³ ìœ  ì‹ë³„ì',
    parameter_id     BIGINT                                         NOT NULL                    COMMENT 'íŒŒë¼ë¯¸í„° ì‹ë³„ì (FK)',
    old_value        DECIMAL(10,4)                                                              COMMENT 'ë³€ê²½ ì „ ê°’',
    new_value        DECIMAL(10,4)                                  NOT NULL                    COMMENT 'ë³€ê²½ í›„ ê°’',
    change_reason    TEXT                                                                       COMMENT 'ë³€ê²½ ì‚¬ìœ ',
    changed_by       VARCHAR(100)                                   NOT NULL                    COMMENT 'ë³€ê²½ì',
    effective_from   TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ì ìš© ì‹œì‘ ì‹œê°„',
    created_at       TIMESTAMP                                      DEFAULT CURRENT_TIMESTAMP  COMMENT 'ë³€ê²½ ê¸°ë¡ ì‹œê°„',
    
    FOREIGN KEY (parameter_id) REFERENCES ad_engine_parameters(id),
    INDEX idx_parameter_created (parameter_id, created_at),
    INDEX idx_changed_by (changed_by),
    INDEX idx_effective_from (effective_from)
) ENGINE=InnoDB COMMENT='ì—”ì§„ íŒŒë¼ë¯¸í„° ë³€ê²½ ì´ë ¥ - íŒŒë¼ë¯¸í„° ì¡°ì • ì¶”ì  ë° ë¡¤ë°± ì§€ì›';
```

---

## ğŸ“Š ë°ì´í„° ì²˜ë¦¬ ì „ëµ

### **ì‹¤ì‹œê°„ vs ë°°ì¹˜ ì²˜ë¦¬ êµ¬ë¶„**

| ì²˜ë¦¬ ë°©ì‹ | ë°ì´í„° ì €ì¥ì†Œ | ëª©ì  | ë³´ê´€ ê¸°ê°„ |
|-----------|---------------|------|-----------|
| **ì‹¤ì‹œê°„ ì²˜ë¦¬** | MariaDB | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ì”ì•¡ ì°¨ê°, ì‹¤ì‹œê°„ ì§€í‘œ | 3-7ì¼ |
| **ë°°ì¹˜ ì²˜ë¦¬** | S3 (Parquet) | ìƒì„¸ ë¶„ì„, ë¦¬í¬íŠ¸, ì¥ê¸° ë³´ê´€ | 2ë…„+ |

### **S3 ì´ë²¤íŠ¸ ì €ì¥ êµ¬ì¡°**
```
s3://cpc-ad-events/
â”œâ”€â”€ year=2024/
â”‚   â”œâ”€â”€ month=01/
â”‚   â”‚   â”œâ”€â”€ day=15/
â”‚   â”‚   â”‚   â”œâ”€â”€ hour=14/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ impression_events.parquet
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ click_events.parquet
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ conversion_events.parquet
â”‚   â”‚   â”‚   â””â”€â”€ hour=15/
â”‚   â”‚   â””â”€â”€ day=16/
â”‚   â””â”€â”€ month=02/
â””â”€â”€ processed/
    â”œâ”€â”€ daily_reports/
    â””â”€â”€ monthly_aggregates/
```

### **ì´ë²¤íŠ¸ ì²˜ë¦¬ íë¦„**
```
ì‹¤ì‹œê°„: Kafka â†’ Flink â†’ {Redis ì§€í‘œ, DB ì§‘ê³„}
ë°°ì¹˜:   Kafka â†’ S3 â†’ Athena/Spark â†’ {ë¦¬í¬íŠ¸, ë¶„ì„}
```

---

## âš¡ íŒŒí‹°ì…”ë‹ ë° ì„±ëŠ¥ ìµœì í™”

### 1. ëŒ€ìš©ëŸ‰ í…Œì´ë¸” íŒŒí‹°ì…”ë‹

**ëŒ€ìš©ëŸ‰ í…Œì´ë¸”ë³„ íŒŒí‹°ì…”ë‹ ì „ëµ**

| í…Œì´ë¸” | íŒŒí‹°ì…”ë‹ ë°©ì‹ | ë³´ê´€ ê¸°ê°„ | ìë™ ì •ë¦¬ |
|--------|---------------|-----------|-----------|
| `ad_event_summaries_daily` | ì›”ë³„ | 13ê°œì›” | ìŠ¤ì¼€ì¤„ëŸ¬ |
| `ad_performance_metrics_realtime` | ì¼ë³„ | 7ì¼ | TTL |
| `ad_impression_pricings` | ì¼ë³„ | 24ì‹œê°„ | TTL |
| `ad_balance_histories` | ì›”ë³„ | 2ë…„ | ë³´ê´€ |

```sql
-- 1. ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ (ì¼ë³„ íŒŒí‹°ì…”ë‹ + TTL)
ALTER TABLE ad_performance_metrics_realtime 
PARTITION BY RANGE (TO_DAYS(metric_hour)) (
    PARTITION p_today VALUES LESS THAN (TO_DAYS(CURDATE() + INTERVAL 1 DAY)),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- 2. ë…¸ì¶œ ê°€ê²© ë§¤í•‘ (ìë™ ë§Œë£Œ)
CREATE EVENT cleanup_expired_impressions
ON SCHEDULE EVERY 1 HOUR
DO DELETE FROM ad_impression_pricings WHERE expires_at < NOW();

-- 3. ì¼ë³„ ìš”ì•½ (ì›”ë³„ íŒŒí‹°ì…”ë‹)
ALTER TABLE ad_event_summaries_daily 
PARTITION BY RANGE (YEAR(summary_date) * 100 + MONTH(summary_date)) (
    PARTITION p202401 VALUES LESS THAN (202402),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 2. í•µì‹¬ ì¸ë±ìŠ¤ ì „ëµ

**ì„±ëŠ¥ ì¤‘ìš”ë„ë³„ ì¸ë±ìŠ¤ êµ¬ì„±**

| ìš°ì„ ìˆœìœ„ | ì¸ë±ìŠ¤ ìš©ë„ | í…Œì´ë¸” | ì˜ˆìƒ QPS |
|----------|-------------|--------|----------|
| **P0** | RTB ì…ì°°ê°€ ì¡°íšŒ | `ad_placement_bids` | 1000+ |
| **P0** | ì”ì•¡ ì‹¤ì‹œê°„ ì²´í¬ | `ad_balances` | 1000+ |
| **P0** | í´ë¦­ ê°€ê²© ë§¤í•‘ | `ad_impression_pricings` | 500+ |
| **P1** | ë°©ì–´ê°’ í†µê³„ ì¡°íšŒ | `ad_category_defense_stats` | 100+ |
| **P1** | ì„±ê³¼ ì§€í‘œ ì¡°íšŒ | `ad_performance_metrics_realtime` | 50+ |

```sql
-- P0: RTB ì•Œê³ ë¦¬ì¦˜ í•µì‹¬ ì¸ë±ìŠ¤
CREATE INDEX idx_rtb_lookup ON ad_placement_bids 
(placement, status, product_id) INCLUDE (bid_price, max_daily_spend);

CREATE INDEX idx_balance_check ON ad_balances (advertiser_id) 
INCLUDE (current_balance, daily_spent, alert_threshold);

CREATE INDEX idx_pricing_lookup ON ad_impression_pricings 
(device_id, product_id, placement, impression_time DESC);

-- P1: ë³´ì¡° ì„±ëŠ¥ ì¸ë±ìŠ¤
CREATE INDEX idx_defense_stats ON ad_category_defense_stats 
(category_path, category_level) INCLUDE (avg_ctr, min_ctr, avg_cvr, min_cvr);

CREATE INDEX idx_metrics_hour ON ad_performance_metrics_realtime 
(campaign_id, placement, metric_hour DESC);

-- P2: ê´€ë¦¬/ë¶„ì„ìš© ì¸ë±ìŠ¤
CREATE INDEX idx_parameter_active ON ad_engine_parameters 
(parameter_name, is_active, effective_from, effective_until);
```

---

## ğŸ“‹ í…Œì´ë¸” ê´€ê³„ ìš”ì•½

### **í•µì‹¬ ê´€ê³„ë„**
```
ad_advertisers (1) â†â†’ (N) ad_campaigns
ad_campaigns (1) â†â†’ (N) ad_placement_bids
ad_placement_bids (N) â†â†’ (1) ad_products_meta
ad_advertisers (1) â†â†’ (1) ad_balances
```

### **ë°ì´í„° íë¦„**
1. **ê´‘ê³  ìš”ì²­** â†’ `ad_placement_bids`, `ad_products_meta` ì¡°íšŒ
2. **í´ë¦­ ë°œìƒ** â†’ `ad_impression_pricings`ì—ì„œ ê°€ê²© í™•ì¸ â†’ `ad_balances` ì°¨ê°
3. **ì„±ê³¼ ì§‘ê³„** â†’ `ad_performance_metrics_realtime` ì—…ë°ì´íŠ¸
4. **ì¼ë³„ ì •ì‚°** â†’ `ad_event_summaries_daily` ìƒì„±
