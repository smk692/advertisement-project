# API ì„œë²„ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì—…ë°ì´íŠ¸)

> **API ì„œë²„ ì±…ì„ ë²”ìœ„**: 
> - HTTP ìš”ì²­ ì²˜ë¦¬ ë° ì¦‰ì‹œ ì‘ë‹µ (3-5ms Cache Hit, 15-20ms Cache Miss)
> - RTB ë¡œì§ ì‹¤í–‰ (ê´‘ê³  ë§¤ì¹­/ê°€ê²© ê²°ì •)  
> - Redis ê¸°ë°˜ ì„ ì°¨ê° ì²˜ë¦¬
> - Kafka ì´ë²¤íŠ¸ ë°œí–‰ (ë¹„ë™ê¸°)
> - **ê¸°ìˆ  ìŠ¤íƒ**: Kotlin + Spring Boot + Redis + Kafka
> - **ì„¤ê³„ ì›ì¹™**: FK ì œì•½ì¡°ê±´ ì—†ìŒ, ë…¼ë¦¬ì  ì—°ê²°ë§Œ ìœ ì§€

---

## ğŸ“‹ API ëª©ë¡ ë° ì„±ëŠ¥ ëª©í‘œ

| êµ¬ë¶„         | ì—”ë“œí¬ì¸íŠ¸                                      | ë©”ì„œë“œ   | ì£¼ìš” ê¸°ëŠ¥                                     | ëª©í‘œ ì‘ë‹µì‹œê°„ |
|--------------|------------------------------------------------|----------|-----------------------------------------------|---------------|
| ê´‘ê³  ì„œë¹™    | /api/v1/ads/request                            | POST     | ê´‘ê³  ìš”ì²­(RTB ìºì‹œ ì¡°íšŒ + ê°€ê²©ì‹¤í—˜ í›„ì²˜ë¦¬)     | Cache Hit: 3-5ms<br/>Cache Miss: 15-20ms âš ï¸ |
| ì´ë²¤íŠ¸ ì¶”ì   | /api/v1/ads/impression                         | POST     | ë…¸ì¶œ ì´ë²¤íŠ¸ ê¸°ë¡, Kafka ì „ì†¡                   | < 30ms        |
| ì´ë²¤íŠ¸ ì¶”ì   | /api/v1/ads/click                              | POST     | Redis ì„ ì°¨ê°, Kafka ì „ì†¡                       | < 30ms        |
| ì´ë²¤íŠ¸ ì¶”ì   | /api/v1/ads/conversion                         | POST     | ì „í™˜ ì´ë²¤íŠ¸ ê¸°ë¡, Kafka ì „ì†¡                   | < 30ms        |
| ì–´ë“œë¯¼       | /admin/v1/advertisers                          | POST     | ê´‘ê³ ì£¼ ë“±ë¡                                   | < 200ms       |
| ì–´ë“œë¯¼       | /admin/v1/advertisers/{id}/balance             | PUT      | ê´‘ê³ ì£¼ ì”ì•¡ ì¶©ì „/ì°¨ê°                         | < 100ms       |
| ì–´ë“œë¯¼       | /admin/v1/advertisers/{id}/balance             | GET      | ì”ì•¡/ì¼ì˜ˆì‚° í˜„í™© ì¡°íšŒ                         | < 100ms       |
| ì–´ë“œë¯¼       | /admin/v1/campaigns                            | POST     | ìº í˜ì¸ ë“±ë¡                                   | < 200ms       |
| ì–´ë“œë¯¼       | /admin/v1/campaigns/{id}/budget                | GET      | ì˜ˆì‚° í˜„í™© ì¡°íšŒ                                | < 100ms       |
| ì–´ë“œë¯¼       | /admin/v1/advertisers/{id}/dashboard           | GET      | ê´‘ê³ ì£¼ ëŒ€ì‹œë³´ë“œ                               | < 500ms       |
| ì–´ë“œë¯¼       | /admin/v1/monitoring/realtime                  | GET      | ì‹œìŠ¤í…œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§                        | < 100ms       |

---

## ğŸš€ ê´‘ê³  ì„œë¹™ API

### âœ… 1. ê´‘ê³  ìš”ì²­ API

**ğŸ“Œ API ì„¤ëª…**
```
ëª©ì : ì‚¬ìš©ìì˜ ê´‘ê³  ìš”ì²­ì— ëŒ€í•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ìµœì ì˜ ê´‘ê³ ë¥¼ ì„ íƒí•˜ì—¬ ë°˜í™˜
ì—­í• : CPC ê´‘ê³  ì‹œìŠ¤í…œì˜ í•µì‹¬ ì—”ì§„, RTB(Real-Time Bidding) ì²˜ë¦¬
ì…ë ¥: ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ (ê²€ìƒ‰ì–´, ì¹´í…Œê³ ë¦¬, ë””ë°”ì´ìŠ¤ ë“±)
ì¶œë ¥: ìµœì í™”ëœ ê´‘ê³  ëª©ë¡ (ê°€ê²©, ìˆœìœ„ í¬í•¨)
íŠ¹ì§•: 50ms ì´ë‚´ ì‘ë‹µ, ì‹¤ì‹œê°„ ì˜ˆì‚°/ì”ì•¡ ì²´í¬, A/B í…ŒìŠ¤íŠ¸ ì§€ì›
ë°ì´í„° ì—°ê²°: FK ì—†ì´ ë…¼ë¦¬ì  ì¡°ì¸ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
```

**ğŸ¯ API êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **ìš”ì²­ ê²€ì¦**
  - [ ] í•„ìˆ˜ íŒŒë¼ë¯¸í„° ì¡´ì¬ ì—¬ë¶€ (ê¸°ê¸°ID, ì„¸ì…˜ID, ë°°ì¹˜ìœ„ì¹˜)
  - [ ] ë°°ì¹˜ìœ„ì¹˜ ê°’ ìœ íš¨ì„± ê²€ì‚¬ (HOME|CATEGORY|SEARCH|PRODUCT_DETAIL)
  - [ ] ìµœëŒ€ê´‘ê³ ìˆ˜ ë²”ìœ„ ì²´í¬ (1~10)
  - [ ] ì‹¤í—˜ í‚¤/ë³€ìˆ˜ ì¡°í•© ìœ íš¨ì„± ê²€ì¦
  - [ ] ìš”ì²­ íšŸìˆ˜ ì œí•œ ì ìš© (rate limiting)

**ğŸ”§ RTB ë¡œì§ (ì‹¤ì‹œê°„ ì¡°íšŒ + ê°€ê²©ì‹¤í—˜ í›„ì²˜ë¦¬) - ì•„í‚¤í…ì²˜ ê¸°ë°˜**

- [ ] **1ë‹¨ê³„: ìš”ì²­ ê²€ì¦ ë° ì „ì²˜ë¦¬**
  ```
  ê²€ì¦ í•­ëª©:
  - ê¸°ê¸°ID: 36ì UUID í˜•ì‹ í™•ì¸
  - ì„¸ì…˜ID: ì„¸ì…˜ ìœ íš¨ì„± ë° ë§Œë£Œ ì‹œê°„ ì²´í¬
  - ë°°ì¹˜ìœ„ì¹˜: ENUM ê°’ ê²€ì¦ (HOME|CATEGORY|PRODUCT_DETAIL|SEARCH)
  - ê²€ìƒ‰ì–´: SEARCH ë°°ì¹˜ìœ„ì¹˜ì¸ ê²½ìš° í•„ìˆ˜, 2-100ì ì œí•œ
  - ì¹´í…Œê³ ë¦¬: CATEGORY ë°°ì¹˜ìœ„ì¹˜ì¸ ê²½ìš° í•„ìˆ˜
  - ì‹¤í—˜í‚¤, ì‹¤í—˜ë³€ìˆ˜: ì‹¤í—˜ ì§„í–‰ ì¤‘ì¸ ê²½ìš° ë§¤í•‘ í…Œì´ë¸” ì¡´ì¬ í™•ì¸
  - ìµœëŒ€ê´‘ê³ ìˆ˜: 1-10 ë²”ìœ„, ê¸°ë³¸ê°’ 3
  
  ì „ì²˜ë¦¬:
  - ê²€ìƒ‰ì–´ ì •ê·œí™” (ê³µë°± ì œê±°, ì†Œë¬¸ì ë³€í™˜)
  - ì¹´í…Œê³ ë¦¬ ê³„ì¸µ êµ¬ì¡° íŒŒì‹±
  - ì‹¤í—˜ ê·¸ë£¹ í• ë‹¹ ê²€ì¦
  ```

- [ ] **2ë‹¨ê³„: Redis RTB ìºì‹œ ì¡°íšŒ (ë‹¨ìˆœ ì¡°íšŒë§Œ)**
  ```
  â­ ì•„í‚¤í…ì²˜ ì •ì •: ê°€ê²©ì€ ì´ë¯¸ STEP 1ì—ì„œ Flinkê°€ ê³„ì‚° ì™„ë£Œ
  
  ğŸ¯ ìºì‹œ íˆíŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (95% ì¼€ì´ìŠ¤ - 3-5ms ëª©í‘œ):
  1. ì‚¬ì „ ê³„ì‚°ëœ RTB ê²°ê³¼ ì¡°íšŒ
     Redis Key: rtb:{placement}:{category}
     Value: [
       {campaign_id: 100, product_id: "SAMSUNG_NB_001", calculated_price: 1200, rank: 1},
       {campaign_id: 101, product_id: "LG_TV_002", calculated_price: 1100, rank: 2}
     ]
     
  2. ë³‘ë ¬ ìƒíƒœ í™•ì¸ (ë™ì‹œ ì‹¤í–‰ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”)
     Promise.all([
       Redis.get(balance:{advertiser_id_1}),
       Redis.get(balance:{advertiser_id_2}),
       Redis.get(daily_spent:{campaign_id_1}:{date}),
       Redis.get(daily_spent:{campaign_id_2}:{date})
     ])
     
  3. ìœ íš¨ ê´‘ê³  í•„í„°ë§ (ê³„ì‚° ì—†ì´ í•„í„°ë§ë§Œ)
     - ì”ì•¡ ì¶©ë¶„í•œ ê´‘ê³ ì£¼ì˜ ìº í˜ì¸ë§Œ
     - ì¼ì˜ˆì‚° ì—¬ìœ  ìˆëŠ” ìº í˜ì¸ë§Œ
     - activated = 1 ìƒíƒœì¸ ìº í˜ì¸ë§Œ
  
  âŒ ìºì‹œ ë¯¸ìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ (5% ì¼€ì´ìŠ¤ - 15-20ms):
  1. DB Fallback ì¡°íšŒ (ê¸°ë³¸ ê´‘ê³ ë§Œ)
     - ad_campaignsì—ì„œ ê¸°ë³¸ í™œì„± ìº í˜ì¸ ì¡°íšŒ
     - ì…ì°°ê°€ ê¸°ì¤€ ë‹¨ìˆœ ì •ë ¬ (í’ˆì§ˆì ìˆ˜ ì—†ì´)
     
  2. ìºì‹œ ì¬ìƒì„± ìš”ì²­ (ì¤‘ìš”!)
     - campaign-events í† í”½ì— ì¬ê³„ì‚° ì´ë²¤íŠ¸ ë°œí–‰
     - Flinkê°€ STEP 1 ë¡œì§ìœ¼ë¡œ ì¬ê³„ì‚° ìˆ˜í–‰
  ```

- [ ] **3ë‹¨ê³„: ì‹¤ì‹œê°„ ì”ì•¡/ì˜ˆì‚° ê²€ì¦**
  ```
  ë³‘ë ¬ ê²€ì¦ ë¡œì§ (ì„±ëŠ¥ ìµœì í™”):
  1. ë¹„ë™ê¸° ë³‘ë ¬ ì¡°íšŒ
     const checks = await Promise.all([
       redis.get(`balance:${advertiser_id}`),
       redis.get(`daily_spent:${campaign_id}:${date}`)
     ]);
     
  2. ì˜ˆìƒ ë¹„ìš© ê³„ì‚°
     ì˜ˆìƒë¹„ìš© = ìº í˜ì¸ì…ì°°ê°€ * ì˜ˆìƒí´ë¦­ë¥ 
     
  3. í•„í„°ë§ ì¡°ê±´
     - ì”ì•¡ >= ì˜ˆìƒë¹„ìš©
     - ì¼ì‚¬ìš©ëŸ‰ + ì˜ˆìƒë¹„ìš© <= ì¼ì˜ˆì‚°
     - ìº í˜ì¸ ìƒíƒœ = 'ACTIVE'
  ```

- [ ] **4ë‹¨ê³„: ê°€ê²©ì‹¤í—˜ í›„ì²˜ë¦¬ (ì•„í‚¤í…ì²˜ í•µì‹¬)**
  ```
  â­ ì‹ ê·œ ì¶”ê°€: ì•„í‚¤í…ì²˜ STEP 2 ê°€ê²©ì‹¤í—˜ í›„ì²˜ë¦¬ ë°˜ì˜
  
  ì‹¤í—˜ ì²˜ë¦¬ í”Œë¡œìš°:
  1. í• ë‹¹ëœ ìƒí’ˆì˜ ì‹¤í—˜ ì—¬ë¶€ í™•ì¸
     if (exp_key != null && exp_var != null):
         ì‹¤í—˜ ëŒ€ìƒ ìƒí’ˆ í•„í„°ë§
         
  2. ì‹¤í—˜ ë§¤í•‘ í…Œì´ë¸” ì¡°íšŒ
     SELECT ì‹¤í—˜ìƒí’ˆì½”ë“œ, ì›ë³¸ìƒí’ˆì½”ë“œ 
     FROM experiment_mapping 
     WHERE exp_key = ? AND exp_var = ? 
     AND ì›ë³¸ìƒí’ˆID IN (í• ë‹¹ëœ ìƒí’ˆ ëª©ë¡)
     AND activated = 1
     AND start_date <= NOW() <= end_date
     
  3. ì‹¤í—˜êµ°ë³„ ì½”ë“œ ë³€í™˜
     ì›ë³¸: SAMSUNG_NB_001
     ì‹¤í—˜: SAMSUNG_NB_001_SALE (í• ì¸ ì‹¤í—˜êµ°)
     
     for each í• ë‹¹ëœ_ìƒí’ˆ:
         if (ì‹¤í—˜_ë§¤í•‘_ì¡´ì¬):
             ìƒí’ˆì½”ë“œ = ì‹¤í—˜ìƒí’ˆì½”ë“œ
         else:
             ìƒí’ˆì½”ë“œ = ì›ë³¸ìƒí’ˆì½”ë“œ
             
  4. ì›ë³¸ì½”ë“œ-ì‹¤í—˜ì½”ë“œ ë§¤í•‘ ì €ì¥ (ì¶”ì ìš©)
     Redis: experiment:mapping:{session_id} = {
       "SAMSUNG_NB_001_SALE": "SAMSUNG_NB_001",
       "ì›ë³¸ì¶”ì ": "ì‹¤í—˜ì¶”ì "
     }
     TTL: 24ì‹œê°„ (í´ë¦­-ì „í™˜ ë§¤ì¹­ìš©)
     
  5. ì‹¤í—˜ ì°¸ì—¬ ë¡œê¹…
     - ì‹¤í—˜ ê·¸ë£¹ ë°°ì • ê¸°ë¡
     - ìƒí’ˆ ì½”ë“œ ë³€í™˜ ë¡œê·¸
     - A/B í…ŒìŠ¤íŠ¸ ë¶„ì„ìš© ë°ì´í„°
     
  6. í›„ì²˜ë¦¬(Post-processing) ì ìš© â­ ìš”êµ¬ì‚¬í•­ í•„ìˆ˜
     - Post-processing(Allocation(a,n)) í•¨ìˆ˜ ì‹¤í–‰
     - ìµœì¢… ìƒí’ˆ ì½”ë“œ í™•ì • (ì‹¤í—˜êµ° ì½”ë“œ or ì›ë³¸ ì½”ë“œ)
     - ë…¸ì¶œ ì‹œ ì‚°ì •ëœ ì ìš©ê°€ ê¸°ë¡ (í´ë¦­ ì‹œ ì°¨ê°ìš©)
  ```

- [ ] **5ë‹¨ê³„: ê°€ê²© ì •ë³´ ì¶”ì¶œ (ê³„ì‚° ì—†ìŒ)**
  ```
  âš ï¸ ìˆ˜ì •: ê°€ê²©ì€ STEP 1ì—ì„œ ì´ë¯¸ ê³„ì‚°ë¨, ë‹¨ìˆœ ì¶”ì¶œë§Œ
  
  ê°€ê²© ì •ë³´ ì²˜ë¦¬:
  1. ìºì‹œ íˆíŠ¸: ì‚¬ì „ ê³„ì‚°ëœ ê°€ê²© ì‚¬ìš©
     RTB ìºì‹œì—ì„œ calculated_price í•„ë“œ ì¶”ì¶œ
     â†’ ì´ë¯¸ Pricing(a,n) = min(B(a,n), B(a,n+1)) ì ìš©ë¨
     
  2. ìºì‹œ ë¯¸ìŠ¤: ì…ì°°ê°€ ê¸°ë³¸ê°’ ì‚¬ìš©  
     - ì„ì‹œ ê°€ê²© = ìº í˜ì¸ ì…ì°°ê°€ (ì •í™•í•œ ê³„ì‚°ì€ Flinkì—ì„œ)
     - ìºì‹œ ì¬ìƒì„± í›„ ì •í™•í•œ ê°€ê²© ì ìš©
     
     3. ê°€ê²© ì •ë³´ ë¶ˆí•„ìš” (ë‹¨ìˆœí™”)
      - ìš”êµ¬ì‚¬í•­: [productID, ad_ID] ë°°ì—´ë§Œ ë°˜í™˜
      - í´ë¦­ì‹œ ad_IDë¡œ í˜„ì¬ ìº í˜ì¸ ì •ë³´ ì¡°íšŒí•˜ì—¬ ì°¨ê°
  ```

- [ ] **6ë‹¨ê³„: ìµœì¢… ì‘ë‹µ ìƒì„±**
  ```
  âš ï¸ ì‘ë‹µ í˜•ì‹ ê²€ì¦ í•„ìš” - ìš”êµ¬ì‚¬í•­ ê¸°ì¤€ ë‹¨ìˆœí™”
  
  ìš”êµ¬ì‚¬í•­ ëª…ì„¸: [productID, ad_ID] ë°°ì—´
  â†’ ê¸°ë³¸ ì‘ë‹µ:
  [
    ["SAMSUNG_NB_001_SALE", "ad_001"],
    ["LG_TV_002_SALE", "ad_002"]
  ]
  
  â†’ í™•ì¥ ì‘ë‹µ (ì¶”ì /ì‹¤í—˜ ì •ë³´ í¬í•¨):
  [
    {
      "product_id": "SAMSUNG_NB_001_SALE",
      "ad_id": "ad_001",
      "original_product_id": "SAMSUNG_NB_001",
      "experiment_applied": true
    }
  ]
  
  ì‘ë‹µ ìµœì í™”:
  - ìºì‹œ íˆíŠ¸: 3-5ms ëª©í‘œ
  - ìºì‹œ ë¯¸ìŠ¤: 8-12ms ëª©í‘œ  
  - ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì§€ì—° ìµœì†Œí™”
  - ê³µí†µ í•„ë“œ í¬í•¨ (activated, created_at, updated_at)
  ```

- [ ] **ì‘ë‹µ ìƒì„± (ê³µí†µ í•„ë“œ í¬í•¨)**
  - [ ] ê´‘ê³  ë©”íƒ€ë°ì´í„° í¬í•¨
  - [ ] ì¶”ì ìš© íŒŒë¼ë¯¸í„° ìƒì„±
  - [ ] ê³µí†µ í•„ë“œ (activated, created_at, updated_at) í¬í•¨
  - [ ] ì‘ë‹µ ì‹œê°„ ì¸¡ì • ë° í¬í•¨

---

## ğŸ“Š ì´ë²¤íŠ¸ ì¶”ì  API

### âœ… 2. ë…¸ì¶œ ì¶”ì  API

**ğŸ“Œ API ì„¤ëª…**
```
ëª©ì : ì‚¬ìš©ìì—ê²Œ ê´‘ê³ ê°€ ì‹¤ì œë¡œ ë…¸ì¶œë˜ì—ˆìŒì„ ê¸°ë¡
ì—­í• : CTR ê³„ì‚°ì˜ ë¶„ëª¨ ë°ì´í„° ìˆ˜ì§‘, ê´‘ê³  ì„±ê³¼ ì¸¡ì • ê¸°ì¤€ì 
ì…ë ¥: ê´‘ê³ ID, ìš”ì²­ID, ë…¸ì¶œì‹œê°„
ì¶œë ¥: ì¦‰ì‹œ ì„±ê³µ ì‘ë‹µ (200 OK)
Kafka: ad-events í† í”½ìœ¼ë¡œ IMPRESSION ì´ë²¤íŠ¸ ë°œí–‰
```

**ğŸ¯ API êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **ìš”ì²­ ê²€ì¦**
  - [ ] ê´‘ê³ ID ì¡´ì¬ ë° ìœ íš¨ì„± ê²€ì‚¬ (ë…¼ë¦¬ì  ê²€ì¦)
  - [ ] ìš”ì²­ID ë§¤ì¹­ í™•ì¸
  - [ ] ë…¸ì¶œì‹œê°„ í˜•ì‹ ê²€ì¦

- [ ] **ì´ë²¤íŠ¸ ì²˜ë¦¬**
  - [ ] ë…¸ì¶œ ì´ë²¤íŠ¸ ê°ì²´ ìƒì„±
  - [ ] í•„ìˆ˜ í•„ë“œ ëˆ„ë½ ê²€ì‚¬
  - [ ] ì´ë²¤íŠ¸ ì •ê·œí™” ì²˜ë¦¬

- [ ] **Kafka ë°œí–‰ (í† í”½ ì„¤ê³„ ë°˜ì˜)**
  ```
  â­ ì—…ë°ì´íŠ¸: í†µí•© ad-events í† í”½ ì‚¬ìš©
  
  í† í”½: ad-events
  ì´ë²¤íŠ¸ íƒ€ì…: IMPRESSION
  íŒŒí‹°ì…”ë‹: device_id ê¸°ì¤€ (24ì‹œê°„ ë§¤ì¹­ ìµœì í™”)
  
  ìŠ¤í‚¤ë§ˆ:
  {
    "event_type": "IMPRESSION",
    "timestamp": "2024-01-15T10:30:00Z",
    "device_id": "device_12345",
    "session_id": "session_67890",
    "ad_id": "ad_001",
    "campaign_id": "campaign_100",
    "advertiser_id": "advertiser_50",
    "product_id": "product_200",
    "placement": "HOME|CATEGORY|PRODUCT_DETAIL|SEARCH",
    "bid_price": 1500,
    "actual_price": 1200,
    "search_term": "ë…¸íŠ¸ë¶",
    "category": "ì „ìì œí’ˆ/ì»´í“¨í„°"
  }
  ```
  - [ ] ë°œí–‰ ì‹¤íŒ¨ ì‹œ ë¡œê¹…
  - [ ] ì¦‰ì‹œ 200 OK ì‘ë‹µ

### âœ… 3. í´ë¦­ ì¶”ì  API

**ğŸ“Œ API ì„¤ëª…**
```
ëª©ì : ì‚¬ìš©ìì˜ ê´‘ê³  í´ë¦­ ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¹„ìš©ì„ ì°¨ê°í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ê¸°ë¡
ì—­í• : CPC ê³¼ê¸ˆì˜ í•µì‹¬, ê´‘ê³ ì£¼ ì”ì•¡ì—ì„œ ì¦‰ì‹œ í´ë¦­ ë¹„ìš© ì°¨ê°
ì…ë ¥: ê´‘ê³ ID, ê¸°ê¸°ID, í´ë¦­ì‹œê°„
ì¶œë ¥: ì°¨ê° ì„±ê³µ/ì‹¤íŒ¨ ê²°ê³¼, ì”ì—¬ ì”ì•¡ ì •ë³´
íŠ¹ì§•: 30ms ì´ë‚´ ì‘ë‹µ, Redis ê¸°ë°˜ ì›ìì  íŠ¸ëœì­ì…˜, ì¤‘ë³µ í´ë¦­ ë°©ì§€
ì•„í‚¤í…ì²˜: Workerì™€ Flinkê°€ ad-eventsë¥¼ ì´ì¤‘ ì†Œë¹„
```

**ğŸ¯ API êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **ì¤‘ë³µ í´ë¦­ ë°©ì§€**
  - [ ] Redisì— í´ë¦­ í‚¤ ìƒì„± (ê´‘ê³ ID + ê¸°ê¸°ID + í´ë¦­ì‹œê°„)
  - [ ] SETNXë¡œ ì¤‘ë³µ ì²´í¬ (1ì‹œê°„ TTL)
  - [ ] ì¤‘ë³µ ì‹œ ì¦‰ì‹œ ì‹¤íŒ¨ ì‘ë‹µ

- [ ] **í´ë¦­ì‹œ ì‹¤ì‹œê°„ ìº í˜ì¸ ì •ë³´ ì¡°íšŒ**
  ```
  â­ ë‹¨ìˆœí™”: ad_IDë¡œ í˜„ì¬ ìº í˜ì¸ ìƒíƒœ ë° ê°€ê²© ì¡°íšŒ
  
  1. ad_IDë¡œ ìº í˜ì¸ ì •ë³´ ì¡°íšŒ
     ad_campaigns í…Œì´ë¸”ì—ì„œ campaign_id, advertiser_id ê²€ìƒ‰
     
  2. í˜„ì¬ ì…ì°°ê°€ ì¡°íšŒ
     ad_placement_bidsì—ì„œ í˜„ì¬ ì„¤ì •ëœ ì…ì°°ê°€ ì¡°íšŒ
     í˜„ì¬ ìº í˜ì¸ ìƒíƒœ í™•ì¸ (ACTIVE, ì˜ˆì‚° ì—¬ìœ  ë“±)
     
  3. ì‹¤ì‹œê°„ ê°€ê²© ì ìš©
     - Flink ìºì‹œì— ê³„ì‚°ëœ ê°€ê²©ì´ ìˆìœ¼ë©´ ì‚¬ìš©
     - ì—†ìœ¼ë©´ í˜„ì¬ ì…ì°°ê°€ ì‚¬ìš©
     - ë” ê°„ë‹¨: í•­ìƒ í˜„ì¬ ì…ì°°ê°€ ì‚¬ìš©
  ```

**ğŸ”§ Redis ì„ ì°¨ê° ë¡œì§ (MULTI/EXEC íŠ¸ëœì­ì…˜)**

- [ ] **Redis íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ìƒì„¸**
  ```
  1. íŠ¸ëœì­ì…˜ ì‹œì‘
     MULTI
     
  2. í˜„ì¬ ìƒíƒœ ì¡°íšŒ (íŠ¸ëœì­ì…˜ íì— ì¶”ê°€)
     ì”ì•¡í‚¤ = "balance:{ê´‘ê³ ì£¼ID}"
     ì¼ì˜ˆì‚°í‚¤ = "daily_spent:{ìº í˜ì¸ID}:{YYYY-MM-DD}"
     
     GET {ì”ì•¡í‚¤}           # í˜„ì¬ ì”ì•¡ ì¡°íšŒ
     GET {ì¼ì˜ˆì‚°í‚¤}         # ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰ ì¡°íšŒ
     
  3. ì”ì•¡ ì°¨ê° ëª…ë ¹ (íŠ¸ëœì­ì…˜ íì— ì¶”ê°€)
     DECRBY {ì”ì•¡í‚¤} {í´ë¦­ê¸ˆì•¡}
     
  4. ì¼ì˜ˆì‚° ì¹´ìš´í„° ì¦ê°€ (íŠ¸ëœì­ì…˜ íì— ì¶”ê°€)
     INCRBY {ì¼ì˜ˆì‚°í‚¤} {í´ë¦­ê¸ˆì•¡}
     EXPIRE {ì¼ì˜ˆì‚°í‚¤} 86400
     
  5. íŠ¸ëœì­ì…˜ ì‹¤í–‰
     ê²°ê³¼ = EXEC
     
  6. ê²°ê³¼ ê²€ì¦
     if (ê²°ê³¼ == null || ê²°ê³¼.isEmpty()):
         íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ - ì¬ì‹œë„ ë˜ëŠ” ì—ëŸ¬
     else:
         ì›ë³¸ì”ì•¡ = ê²°ê³¼[0]
         ì¼ì‚¬ìš©ëŸ‰ = ê²°ê³¼[1] 
         ì‹ ê·œì”ì•¡ = ê²°ê³¼[2]
         
  7. ì”ì•¡ ë¶€ì¡± ì²´í¬ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨)
     if (ì›ë³¸ì”ì•¡ < í´ë¦­ê¸ˆì•¡):
         # ë¡¤ë°± ì²˜ë¦¬
         MULTI
         INCRBY {ì”ì•¡í‚¤} {í´ë¦­ê¸ˆì•¡}     # ì”ì•¡ ë³µêµ¬
         DECRBY {ì¼ì˜ˆì‚°í‚¤} {í´ë¦­ê¸ˆì•¡}   # ì¼ì˜ˆì‚° ë³µêµ¬
         EXEC
         
         return "ì”ì•¡ë¶€ì¡±"
  ```

- [ ] **Redis í‚¤ êµ¬ì¡° ë° ë°ì´í„° íƒ€ì…**
  ```
  ì”ì•¡ ê´€ë¦¬:
  - Key: balance:{ê´‘ê³ ì£¼ID}
  - Type: STRING (ìˆ«ì)
  - Value: í˜„ì¬ ì”ì•¡ (ì •ìˆ˜, ì› ë‹¨ìœ„)
  - TTL: ì—†ìŒ (ì˜êµ¬ ë³´ê´€)
  
  ì¼ì˜ˆì‚° ì¹´ìš´í„°:
  - Key: daily_spent:{ìº í˜ì¸ID}:{YYYY-MM-DD}
  - Type: STRING (ìˆ«ì)  
  - Value: ì˜¤ëŠ˜ ì‚¬ìš© ê¸ˆì•¡ (ì •ìˆ˜, ì› ë‹¨ìœ„)
  - TTL: 86400ì´ˆ (24ì‹œê°„)
  
  ì¤‘ë³µ í´ë¦­ ë°©ì§€:
  - Key: click:{ê´‘ê³ ID}:{ê¸°ê¸°ID}:{í´ë¦­ì‹œê°„}
  - Type: STRING
  - Value: "1"
  - TTL: 3600ì´ˆ (1ì‹œê°„)
  
  RTB ìºì‹œ (Flink ê³„ì‚° ê²°ê³¼):
  - Key: rtb:{placement}:{category}
  - Type: ZSET (ì ìˆ˜ìˆœ ì •ë ¬)
  - Value: ìº í˜ì¸ID, Score: S_Î± ì ìˆ˜
  
  ë°©ì–´ë¡œì§ ê¸°ì¤€ê°’:
  - Key: defense:category:{level}:ctr
  - Key: defense:category:{level}:cvr
  - Type: STRING (ìˆ«ì)
  - Value: í‰ê· /ìµœì†Œê°’
  ```

- [ ] **ì‘ë‹µ ì²˜ë¦¬**
  - [ ] ì„±ê³µ ì‹œ: ì°¨ê° ê¸ˆì•¡, ë‚¨ì€ ì”ì•¡ í¬í•¨
  - [ ] ì‹¤íŒ¨ ì‹œ: ì‹¤íŒ¨ ì‚¬ìœ  í¬í•¨
  - [ ] ì¦‰ì‹œ ì‘ë‹µ ë°˜í™˜ (ë™ê¸°)

- [ ] **Kafka ì´ë²¤íŠ¸ ë°œí–‰** (ë¹„ë™ê¸°)
  ```
  â­ ì—…ë°ì´íŠ¸: ad-events í† í”½ìœ¼ë¡œ CLICK ì´ë²¤íŠ¸ ë°œí–‰
  
  ì—­í•  ë¶„ë‹´:
  - Worker: ì‹¤ì‹œê°„ ì”ì•¡ ì°¨ê° (ê°„ë‹¨í•œ ì‘ì—…)
  - Flink: ì„±ê³¼ ì§‘ê³„ ë° ì „í™˜ ë§¤ì¹­ (ë³µì¡í•œ ì‘ì—…)
  
  ì´ë²¤íŠ¸ ìŠ¤í‚¤ë§ˆ:
  {
    "event_type": "CLICK",
    "timestamp": "2024-01-15T10:30:00Z",
    "device_id": "device_12345",
    "session_id": "session_67890",
    "ad_id": "ad_001",
    "campaign_id": "campaign_100",
    "advertiser_id": "advertiser_50",
    "product_id": "product_200",
    "placement": "HOME",
    "bid_price": 1500,
    "actual_price": 1200,
    "balance_deducted": true,
    "remaining_balance": 850000
  }
  ```
  - [ ] ë³„ë„ ìŠ¤ë ˆë“œ/ì½”ë£¨í‹´ì—ì„œ ì²˜ë¦¬
  - [ ] ì°¨ê° ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ í¬í•¨
  - [ ] ë°œí–‰ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ í ë°±ì—…

### âœ… 4. ì „í™˜ ì¶”ì  API

**ğŸ“Œ API ì„¤ëª…**
```
ëª©ì : ì‚¬ìš©ìì˜ êµ¬ë§¤/ì „í™˜ í–‰ë™ì„ ê´‘ê³  í´ë¦­ê³¼ ì—°ê²°í•˜ì—¬ ê¸°ë¡
ì—­í• : CVR ê³„ì‚°ê³¼ ê´‘ê³  íš¨ê³¼ ì¸¡ì •, ROI ë¶„ì„ì˜ ê¸°ì¤€ ë°ì´í„°
ì…ë ¥: ê¸°ê¸°ID, ì„¸ì…˜ID, ì£¼ë¬¸ ì •ë³´
ì¶œë ¥: ì¦‰ì‹œ ì„±ê³µ ì‘ë‹µ (200 OK)
íŠ¹ì§•: 24ì‹œê°„ ë‚´ í´ë¦­-ì „í™˜ ë§¤ì¹­, ìƒí’ˆë³„ ì „í™˜ ì¶”ì 
ì•„í‚¤í…ì²˜: conversion-eventsì™€ ad-eventsë¥¼ Flinkì—ì„œ 24ì‹œê°„ ìœˆë„ìš° ì¡°ì¸
```

**ğŸ¯ API êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **ìš”ì²­ ê²€ì¦**
  - [ ] ê¸°ê¸°ID, ì„¸ì…˜ID ì¡´ì¬ í™•ì¸
  - [ ] ìƒí’ˆ ì •ë³´ ë°°ì—´ ê²€ì¦
  - [ ] ê°€ê²© ì •ë³´ ìœ íš¨ì„± ê²€ì‚¬

- [ ] **ì´ë²¤íŠ¸ ì²˜ë¦¬**
  - [ ] 24ì‹œê°„ ë§¤ì¹­ìš© ì„¸ì…˜ ì •ë³´ í¬í•¨
  - [ ] ìƒí’ˆë³„ ì „í™˜ ì •ë³´ ì •ë¦¬
  - [ ] ì „í™˜ ì´ë²¤íŠ¸ ê°ì²´ ìƒì„±

- [ ] **Kafka ë°œí–‰ (ë³„ë„ í† í”½)**
  ```
  â­ ì—…ë°ì´íŠ¸: conversion-events ë³„ë„ í† í”½ ì‚¬ìš©
  
  í† í”½: conversion-events
  íŒŒí‹°ì…”ë‹: device_id ê¸°ì¤€ (ad-eventsì™€ ë™ì¼)
  
  ìŠ¤í‚¤ë§ˆ:
  {
    "timestamp": "2024-01-15T14:30:00Z",
    "device_id": "device_12345",
    "session_id": "session_67890",
    "order_id": "order_789",
    "product_id": "product_200",
    "revenue_amount": 50000,
    "conversion_type": "PURCHASE|ADD_TO_CART|SIGNUP",
    "attribution_window": 24,
    "referrer_url": "https://example.com/product/200"
  }
  ```
  - [ ] ì¦‰ì‹œ 200 OK ì‘ë‹µ

---

## ğŸ¢ ì–´ë“œë¯¼ API

### âœ… 5. ê´‘ê³ ì£¼ ë“±ë¡ API

**ğŸ¯ API êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **ì…ë ¥ ê²€ì¦**
  - [ ] ì‚¬ì—…ìë²ˆí˜¸ í˜•ì‹ ê²€ì¦
  - [ ] ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
  - [ ] í•„ìˆ˜ í•„ë“œ ëˆ„ë½ ê²€ì‚¬
  - [ ] ì‚¬ì—…ìë²ˆí˜¸ ì¤‘ë³µ ê²€ì‚¬

- [ ] **ë°ì´í„° ì €ì¥ (ê³µí†µ í•„ë“œ í¬í•¨)**
  ```
  
  INSERT INTO ad_advertisers (
    advertiser_name, business_type, status,
    activated, created_at, updated_at, 
    created_user_id, updated_user_id
  ) VALUES (
    ?, ?, 'ACTIVE',
    1, NOW(), NOW(),
    ?, ?
  )
  ```
  - [ ] ê´‘ê³ ì£¼ í…Œì´ë¸”ì— ì €ì¥
  - [ ] ê³ ìœ  ID ìƒì„±
  - [ ] ì´ˆê¸° ì”ì•¡ ì„¤ì • (ì˜µì…˜)
  - [ ] ê³µí†µ í•„ë“œ ì„¤ì • (activated=1, ìƒì„±ì/ìˆ˜ì •ì ID)

- [ ] **Redis ë™ê¸°í™”**
  - [ ] ì”ì•¡ ì •ë³´ Redisì— ì €ì¥
  - [ ] ê´‘ê³ ì£¼ ë©”íƒ€ë°ì´í„° ìºì‹±

### âœ… 6. ì”ì•¡ ê´€ë¦¬ API

**ğŸ¯ API êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **ì…ë ¥ ê²€ì¦**
  - [ ] action íƒ€ì… ê²€ì¦ (charge|deduct)
  - [ ] ê¸ˆì•¡ ì–‘ìˆ˜ ê²€ì¦
  - [ ] ê´‘ê³ ì£¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ (activated=1)

- [ ] **ì”ì•¡ ì²˜ë¦¬ (ê³µí†µ í•„ë“œ ì—…ë°ì´íŠ¸)**
  ```
  
  1. ê´‘ê³ ì£¼ ì¡´ì¬ í™•ì¸
     SELECT COUNT(*) FROM ad_advertisers 
     WHERE id = ? AND activated = 1
     
  2. ì”ì•¡ ì—…ë°ì´íŠ¸ (ê³µí†µ í•„ë“œ í¬í•¨)
     UPDATE ad_balances SET
       current_balance = current_balance + ?,
       updated_at = NOW(),
       updated_user_id = ?
     WHERE advertiser_id = ?
     
  3. ì´ë ¥ ê¸°ë¡ (ê³µí†µ í•„ë“œ í¬í•¨)
     INSERT INTO ad_balance_histories (
       advertiser_id, transaction_type, amount,
       balance_before, balance_after,
       activated, created_at, created_user_id
     ) VALUES (?, ?, ?, ?, ?, 1, NOW(), ?)
  ```
  - [ ] DB íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì”ì•¡ ì—…ë°ì´íŠ¸
  - [ ] ì°¨ê° ì‹œ ì”ì•¡ ë¶€ì¡± ê²€ì‚¬
  - [ ] ë³€ê²½ ì´ë ¥ í…Œì´ë¸”ì— ê¸°ë¡

- [ ] **Redis ë™ê¸°í™”**
  - [ ] DB ì—…ë°ì´íŠ¸ ì„±ê³µ í›„ Redis ì—…ë°ì´íŠ¸
  - [ ] ë™ê¸°í™” ì‹¤íŒ¨ ì‹œ ì•Œë¦¼

### âœ… 7. ìº í˜ì¸ ë“±ë¡ API

**ğŸ¯ API êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **ì…ë ¥ ê²€ì¦ (ë…¼ë¦¬ì  ì—°ê²°)**
  ```
  
  1. ê´‘ê³ ì£¼ ì¡´ì¬ í™•ì¸
     SELECT COUNT(*) FROM ad_advertisers 
     WHERE id = ? AND activated = 1
     
  2. ìƒí’ˆ ì¡´ì¬ í™•ì¸ (í•´ë‹¹í•˜ëŠ” ê²½ìš°)
     SELECT COUNT(*) FROM ad_products_meta 
     WHERE product_id = ? AND activated = 1
  ```
  - [ ] ì˜ˆì‚° ê¸ˆì•¡ ì–‘ìˆ˜ ê²€ì¦
  - [ ] ì‹œì‘/ì¢…ë£Œ ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
  - [ ] íƒ€ê²Ÿ í‚¤ì›Œë“œ í˜•ì‹ ê²€ì¦

- [ ] **ë°ì´í„° ì €ì¥ (ê³µí†µ í•„ë“œ í¬í•¨)**
  ```
  INSERT INTO ad_campaigns (
    advertiser_id, campaign_name, campaign_type, status,
    start_date, end_date, daily_budget, total_budget,
    activated, created_at, updated_at,
    created_user_id, updated_user_id
  ) VALUES (
    ?, ?, ?, 'PENDING',
    ?, ?, ?, ?,
    1, NOW(), NOW(),
    ?, ?
  )
  ```
  - [ ] ìº í˜ì¸ í…Œì´ë¸”ì— ì €ì¥
  - [ ] íƒ€ê²ŸíŒ… ì¡°ê±´ ì €ì¥
  - [ ] ìƒíƒœë¥¼ PENDINGìœ¼ë¡œ ì„¤ì • (ìŠ¹ì¸ í•„ìš”)

- [ ] **Kafka ì´ë²¤íŠ¸ ë°œí–‰**
  ```
  â­ ì—…ë°ì´íŠ¸: campaign-events í† í”½ìœ¼ë¡œ ì´ë²¤íŠ¸ ë°œí–‰
  
  ì´ë²¤íŠ¸ íƒ€ì…: CAMPAIGN_CREATED
  ì—­í• : Flink RTB Statementê°€ ì²˜ë¦¬í•˜ì—¬ Redis ìˆœìœ„ ìºì‹œ ì—…ë°ì´íŠ¸
  ```
  - [ ] campaign-events í† í”½ìœ¼ë¡œ CAMPAIGN_CREATED ì´ë²¤íŠ¸ ë°œí–‰
  - [ ] RTB ì¬ê³„ì‚° íŠ¸ë¦¬ê±°

---

## ğŸš¨ ê³µí†µ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… 12. ë°ì´í„° ë¬´ê²°ì„± ê´€ë¦¬ (FK ì—†ëŠ” í™˜ê²½)

**ğŸ”§ ë…¼ë¦¬ì  ì—°ê²° ê´€ë¦¬**
- [ ] **ì°¸ì¡° ë¬´ê²°ì„± ì²´í¬**
  ```
  â­ ì‹ ê·œ: FK ì œì•½ ì—†ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ë¬´ê²°ì„± ë³´ì¥
  
  1. ì‚½ì… ì „ ì°¸ì¡° í…Œì´ë¸” ì¡´ì¬ í™•ì¸
     if (advertiser_id != null):
         SELECT COUNT(*) FROM ad_advertisers 
         WHERE id = ? AND activated = 1
         
  2. ë…¼ë¦¬ì  ì¡°ì¸ ì‹œ NULL ì²´í¬
     LEFT JOIN ëŒ€ì‹  EXISTS ì‚¬ìš©ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
     
  3. ë°°ì¹˜ ì •í•©ì„± ì²´í¬ (ì¼ 1íšŒ)
     ê³ ì•„ ë ˆì½”ë“œ ë° ë¶ˆì¼ì¹˜ ë°ì´í„° íƒì§€ ë° ì•Œë¦¼
  ```

  ```
  â­ ì‹ ê·œ: ëª¨ë“  í…Œì´ë¸” í‘œì¤€í™”
  
  1. INSERT/UPDATE ì‹œ ê³µí†µ í•„ë“œ ìë™ ì„¤ì •
     activated = 1 (ê¸°ë³¸ê°’)
     created_at = NOW() (ì‚½ì… ì‹œ)
     updated_at = NOW() (ê°±ì‹  ì‹œ)
     created_user_id = {ë¡œê·¸ì¸ ì‚¬ìš©ì}
     updated_user_id = {ë¡œê·¸ì¸ ì‚¬ìš©ì}
     
  2. Soft Delete ì§€ì›
     DELETE ëŒ€ì‹  activated = 0 ìœ¼ë¡œ ë…¼ë¦¬ ì‚­ì œ
     
  3. ë³€ê²½ ì¶”ì  ì§€ì›
     updated_at, updated_user_idë¡œ ë³€ê²½ ì´ë ¥ ì¶”ì 
  ```

### âœ… 13. ì˜ˆì™¸ ì²˜ë¦¬

**ğŸ”§ í•„ìˆ˜ ì˜ˆì™¸ ì²˜ë¦¬**
- [ ] **ì”ì•¡ ë¶€ì¡± ì˜ˆì™¸**
  - [ ] ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
  - [ ] í˜„ì¬ ì”ì•¡ ì •ë³´ í¬í•¨
  - [ ] ë¡œê¹… ì²˜ë¦¬

- [ ] **ë…¼ë¦¬ì  ì—°ê²° ì‹¤íŒ¨ ì˜ˆì™¸**
  ```
  â­ ì‹ ê·œ: FK ì—†ëŠ” í™˜ê²½ì˜ ì˜ˆì™¸ ì²˜ë¦¬
  
  1. ì°¸ì¡° ë°ì´í„° ëˆ„ë½
     - ì—ëŸ¬ ì½”ë“œ: REFERENCE_NOT_FOUND
     - ë©”ì‹œì§€: "ì°¸ì¡°ëœ {í…Œì´ë¸”}ì˜ {ID}ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
     
  2. ë¹„í™œì„±í™”ëœ ì°¸ì¡° ë°ì´í„°
     - ì—ëŸ¬ ì½”ë“œ: REFERENCE_INACTIVE
     - ë©”ì‹œì§€: "ì°¸ì¡°ëœ {í…Œì´ë¸”}ì´ ë¹„í™œì„±í™” ìƒíƒœì…ë‹ˆë‹¤"
  ```

### âœ… 14. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

**ğŸ”§ í•„ìˆ˜ ëª¨ë‹ˆí„°ë§**
- [ ] **ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­**
  - [ ] ì”ì•¡ ì°¨ê° ì„±ê³µë¥ 
  - [ ] ê´‘ê³  ë§¤ì¹­ ì„±ê³µë¥ 
  - [ ] ì˜ˆì‚° ì†Œì§„ìœ¨
  - [ ] ì‹¤í—˜ ì°¸ì—¬ìœ¨
  - [ ] ë°©ì–´ë¡œì§ ì ìš©ë¥  (ì‹ ê·œ)

- [ ] **ë°ì´í„° ë¬´ê²°ì„± ë©”íŠ¸ë¦­ (ì‹ ê·œ)**
  ```
  â­ ì‹ ê·œ: FK ì—†ëŠ” í™˜ê²½ì˜ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§
  
  1. ê³ ì•„ ë ˆì½”ë“œ íƒì§€ìœ¨
     - ì°¸ì¡° ë°ì´í„°ê°€ ì—†ëŠ” ë ˆì½”ë“œ ë¹„ìœ¨
     - ì¼ì¼ ë°°ì¹˜ë¡œ ì²´í¬ ë° ì•Œë¦¼
     
  2. ë…¼ë¦¬ì  ì¡°ì¸ ì‹¤íŒ¨ìœ¨
     - API í˜¸ì¶œ ì‹œ ì°¸ì¡° ì‹¤íŒ¨ ë¹„ìœ¨
     - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ì•ŒëŒ
     
  3. ê³µí†µ í•„ë“œ ëˆ„ë½ë¥ 
     - activated, created_at ë“± ëˆ„ë½ ë¹„ìœ¨
     - ë°ì´í„° í’ˆì§ˆ ì§€í‘œ
  ```

---

## ğŸ”§ ì„±ëŠ¥ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì—…ë°ì´íŠ¸)

### âœ… 15. Redis ìºì‹œ ìµœì í™” (ì•„í‚¤í…ì²˜ ê¸°ë°˜)

**ğŸ”§ ìºì‹œ ì „ëµ**
- [ ] **RTB ê²°ê³¼ ìºì‹± (Flink ì‚¬ì „ ê³„ì‚°)**
  ```
  â­ ì•„í‚¤í…ì²˜ ë°˜ì˜: STEP 2 ì‹¤ì‹œê°„ ì¡°íšŒ ìµœì í™”
  
  Primary Key êµ¬ì¡°:
  - rtb:{placement}:{category} = [
      {campaign_id: 100, calculated_price: 1200, rank: 1},
      {campaign_id: 101, calculated_price: 1100, rank: 2}
    ]
  - balance:{advertiser_id} = {í˜„ì¬ì”ì•¡}
  - daily_spent:{campaign_id}:{YYYY-MM-DD} = {ì†Œì§„ê¸ˆì•¡}
  
  ì‹¤í—˜ ê´€ë ¨ Key:
  - experiment:mapping:{session_id} = {ì›ë³¸ì½”ë“œ: ì‹¤í—˜ì½”ë“œ}
  - experiment:active:{exp_key} = [í™œì„± ì‹¤í—˜ ë³€ìˆ˜ ëª©ë¡]
  
  ë°©ì–´ë¡œì§ Key:
  - defense:category:{level}:ctr = {í‰ê· /ìµœì†Œê°’}
  - defense:category:{level}:cvr = {í‰ê· /ìµœì†Œê°’}
  ```

- [ ] **ë³‘ë ¬ ì¡°íšŒ ìµœì í™”**
  ```
  â­ ì‹ ê·œ: ì•„í‚¤í…ì²˜ ë³‘ë ¬ ì²˜ë¦¬ íŒ¨í„´
  
  1. Promise.all() í™œìš©
     const [rtbData, balanceData, budgetData] = await Promise.all([
       redis.get(`rtb:${placement}:${category}`),
       redis.mget(advertiserIds.map(id => `balance:${id}`)),
       redis.mget(campaignIds.map(id => `daily_spent:${id}:${date}`))
     ]);
     
  2. Pipeline ì‚¬ìš©
     const pipeline = redis.pipeline();
     pipeline.get(`rtb:${placement}:${category}`);
     pipeline.get(`balance:${advertiser_id}`);
     pipeline.get(`daily_spent:${campaign_id}:${date}`);
     const results = await pipeline.exec();
     
  3. Connection Pool ìµœì í™”
     - ìµœì†Œ 10ê°œ, ìµœëŒ€ 50ê°œ ì—°ê²°
     - Idle timeout: 30ì´ˆ
     - Max retry: 3íšŒ
  ```

- [ ] **ìºì‹œ ë¬´íš¨í™” ì „ëµ**
  - [ ] ìº í˜ì¸ ë³€ê²½ ì‹œ ê´€ë ¨ RTB ìºì‹œ ì‚­ì œ (Flink íŠ¸ë¦¬ê±°)
  - [ ] TTL ê¸°ë°˜ ìë™ ë§Œë£Œ (RTB: 5ë¶„, ì‹¤í—˜ë§¤í•‘: 24ì‹œê°„)
  - [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ (80% ì„ê³„ì¹˜)