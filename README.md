# CPC RTB 광고 시스템 (Cost-Per-Click Real-Time Bidding)

## 프로젝트 개요
커머스 플랫폼과 연동된 CPC 기반 실시간 광고 입찰 시스템입니다. 커머스 사이트에서 광고 노출부터 클릭, 구매까지의 전체 여정을 추적하고 실시간으로 광고 성과를 최적화합니다.

### 🔄 시스템 분리 구조
- **커머스 시스템**: 사용자 인터페이스, 광고 노출, 클릭 이벤트 발생, 구매 및 결제 처리
- **광고 시스템**: 광고 조회 처리, RTB 경쟁, 잔액 관리, 성과 집계

### ⚡ 성능 목표
- **광고 조회 응답**: 3-5ms (Cache Hit 95%)
- **RTB 처리**: Redis 기반 사전 계산된 순위 조회
- **실시간 처리**: Flink 통합 스트림으로 비용 최적화

### 🎯 주요 기능
- **초고속 RTB 처리**: Redis 캐시 기반 3-5ms 응답
- **실시간 잔액 관리**: 클릭 시 즉시 CPC 차감
- **통합 성과 추적**: 노출 → 클릭 → 구매 전환 매칭 (24시간 윈도우)
- **스마트 캐시 전략**: 실시간 변경 데이터만 Redis 저장으로 메모리 70% 절약
- **Flink 통합 처리**: 단일 태스크로 RTB 계산 + 클릭 처리 + 전환 처리 (비용 60-80% 절감)

## 시스템 아키텍처

### 🏗️ 핵심 컴포넌트
1. **광고 API 서버**
   - 커머스 시스템에서 광고 조회 요청 처리 (3-5ms 응답)
   - Redis 기반 초고속 RTB 처리
   - 광고주 캠페인 관리 인터페이스
   - 실시간 잔액 체크 및 차감

2. **Flink 통합 처리 엔진**
   - **RTB 계산**: 캠페인 등록/수정 시 점수 계산 후 Redis 저장
   - **클릭 처리**: 실시간 잔액 차감 및 성과 업데이트
   - **전환 처리**: 24시간 윈도우 내 클릭-구매 매칭
   - **실시간 집계**: CTR, CVR, ROAS 계산
   - 단일 태스크로 모든 스트림 통합 처리 (Confluent Flink 비용 최적화)

3. **Redis 캐시 시스템**
   - `rtb:{placement}:{category}`: 사전 계산된 RTB 순위 리스트
   - `balance:{advertiser_id}`: 실시간 잔액 정보
   - `budget:{campaign_id}:{date}`: 일일 예산 사용 현황
   - `metrics:ctr:{product_id}`: 5분 윈도우 CTR/CVR

4. **Kafka 메시지 큐**
   - `campaign-events`: 캠페인 등록/수정 이벤트
   - `ad-events`: 클릭 이벤트 스트림
   - `order.completed`: 주문 완료 이벤트 (conversion-events에서 변경)

### 📊 업무 플로우
1. **광고주 온보딩** : 회원가입 → 심사 → 승인 → 잔액충전
2. **캠페인 설정** : 등록 → 심사 → 활성화
3. **광고 서비스** : 노출 → 클릭 → 전환 → 정산
4. **성과 관리** : 모니터링 → 최적화 → 리포트

## 프로젝트 구조

```
advertisement-project/
├── docs/
│   ├── 1. 정리/
│   │   ├── 1-1. 용어사전.md      - RTB 관련 용어 정의 (revenue_amount 등 추가)
│   │   ├── 1-0 RTB_요구사항.md    - RTB 시스템 요구사항
│   │   └── 1-1. 요구사항.md       - 일반 시스템 요구사항
│   ├── 2. 설계/
│   │   ├── 2-1. 업무흐름.md       - 실제 비즈니스 프로세스 플로우
│   │   ├── 2-2. 아키텍처.md       - 시스템 아키텍처 설계 (3-5ms 최적화)
│   │   ├── 2-3. 광고_테이블_설계.md - 데이터베이스 스키마 (ERD 포함)
│   │   └── 2-4. 광고_토픽_설계.md  - Kafka 토픽 설계
│   └── 3. 체크리스트/
│       ├── 3-1. 선행데이터_체크리스트.md - 초기 데이터 설정 및 정책 결정사항
│       ├── 3-2. 구현체크리스트_API.md    - API 구현 항목
│       ├── 3-3. 구현체크리스트_Flink.md  - Flink 구현 항목
│       └── 3-4. 구현체크리스트_Worker.md - Worker 구현 항목
```

## 팀 구성 및 역할

### 👥 개발팀 구성
- **API 개발팀**: 광고 조회 API (3-5ms 최적화), 캠페인 관리, Redis 캐시 처리
- **Flink 개발팀**: 통합 스트림 처리 (RTB 계산 + 클릭 처리 + 전환 매칭)
- **Worker 개발팀**: 성과 리포트, 배치 정산, 데이터 동기화

### 🎯 핵심 최적화 전략
- **Cache First**: 95% Cache Hit로 초고속 응답
- **Stream Unification**: Flink 단일 태스크로 비용 최적화
- **Smart Memory**: 실시간 데이터만 Redis 캐시
- **Real-time Processing**: 클릭-전환 매칭 24시간 윈도우

### 💡 최신 개선사항
- **ERD 다이어그램**: 시각적 데이터 모델링으로 테이블 관계 명확화
- **수익률 추적**: revenue_amount 필드로 정확한 ROAS 계산
- **정책 시나리오**: 주문 취소, 중복 주문 등 예외 상황 처리 방안 정립

## 문서화

### 📋 비즈니스 문서
- [업무 플로우](docs/2.%20설계/2-1.%20업무흐름.md) - 전체 비즈니스 프로세스
- [RTB 요구사항](docs/1.%20정리/1-0%20RTB_요구사항.md) - CPC RTB 시스템 요구사항
- [용어사전](docs/1.%20정리/1-1.%20용어사전.md) - RTB 관련 용어 정의 (revenue_amount 등)

### 🏗️ 기술 설계
- [시스템 아키텍처](docs/2.%20설계/2-2.%20아키텍처.md) - 3-5ms 최적화 아키텍처
- [데이터베이스 설계](docs/2.%20설계/2-3.%20광고_테이블_설계.md) - 테이블 스키마 및 ERD
- [Kafka 토픽 설계](docs/2.%20설계/2-4.%20광고_토픽_설계.md) - 이벤트 스트림 설계

### 🛠️ 구현 가이드
- [API 구현 가이드](docs/3.%20체크리스트/3-2.%20구현체크리스트_API.md) - Redis 캐시 최적화
- [Flink 구현 가이드](docs/3.%20체크리스트/3-3.%20구현체크리스트_Flink.md) - 통합 스트림 처리
- [Worker 구현 가이드](docs/3.%20체크리스트/3-4.%20구현체크리스트_Worker.md) - 배치 작업
- [선행데이터 체크리스트](docs/3.%20체크리스트/3-1.%20선행데이터_체크리스트.md) - 정책 결정 및 시나리오 분석